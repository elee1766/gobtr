"use strict";(self.webpackChunkgobtr_web=self.webpackChunkgobtr_web||[]).push([["467"],{355:function(t,e,r){r.r(e),r.d(e,{default:()=>eG});var n=r(35),s=r(701),a=r(953),i=r(359),l=r(369),o=r(479),d=r(37),c=r(548),u=(t,e)=>{let[r,n,s]=t,a=180/Math.PI*Math.atan2(n-.5,r-.5),i=Math.sqrt(Math.pow(n-.5,2)+Math.pow(r-.5,2))/.5;return[a=(360+a)%360,s,e?1-i:i]},h=(t,e)=>{let[r,n,s]=t,a=r/(180/Math.PI),i=(e?1-s:s)*.5;return[.5+i*Math.cos(a),.5+i*Math.sin(a),n]},g=(t=360*Math.random(),e=[Math.random(),Math.random()],r=[.75+.2*Math.random(),.3+.2*Math.random()])=>[[t,e[0],r[0]],[(t+60+180*Math.random())%360,e[1],r[1]]],x=(t,e,r,n=!1,s=(t,e)=>e?1-t:t,a=(t,e)=>e?1-t:t,i=(t,e)=>e?1-t:t)=>{let l=s(t,n),o=a(t,n),d=i(t,n);return[(1-l)*e[0]+l*r[0],(1-o)*e[1]+o*r[1],(1-d)*e[2]+d*r[2]]},p=(t,e=!1)=>e?1-Math.sin((1-t)*Math.PI/2):Math.sin(t*Math.PI/2),b=t=>t,v=(t,e,r=!1)=>{let n=t[0],s=e[0],a=r&&null!==n&&null!==s?Math.min(Math.abs(n-s),360-Math.abs(n-s))/360:null===n||null===s?0:n-s,i=null===t[1]||null===e[1]?0:e[1]-t[1],l=null===t[2]||null===e[2]?0:e[2]-t[2];return Math.sqrt(a*a+i*i+l*l)},f=class{constructor({xyz:t,color:e,invertedLightness:r=!1}={}){this.x=0,this.y=0,this.z=0,this.color=[0,0,0],this._invertedLightness=!1,this._invertedLightness=r,this.positionOrColor({xyz:t,color:e,invertedLightness:r})}positionOrColor({xyz:t,color:e,invertedLightness:r=!1}){if(t&&e||!t&&!e)throw Error("Point must be initialized with either x,y,z or hsl");t?(this.x=t[0],this.y=t[1],this.z=t[2],this.color=u([this.x,this.y,this.z],r)):e&&(this.color=e,[this.x,this.y,this.z]=h(e,r))}set position([t,e,r]){this.x=t,this.y=e,this.z=r,this.color=u([this.x,this.y,this.z],this._invertedLightness)}get position(){return[this.x,this.y,this.z]}set hsl([t,e,r]){this.color=[t,e,r],[this.x,this.y,this.z]=h(this.color,this._invertedLightness)}get hsl(){return this.color}get hslCSS(){let[t,e,r]=this.color;return`hsl(${t.toFixed(2)}, ${(100*e).toFixed(2)}%, ${(100*r).toFixed(2)}%)`}get oklchCSS(){let[t,e,r]=this.color;return`oklch(${(100*r).toFixed(2)}% ${(.4*e).toFixed(3)} ${t.toFixed(2)})`}get lchCSS(){let[t,e,r]=this.color;return`lch(${(100*r).toFixed(2)}% ${(150*e).toFixed(2)} ${t.toFixed(2)})`}shiftHue(t){this.color[0]=(360+(this.color[0]+t))%360,[this.x,this.y,this.z]=h(this.color,this._invertedLightness)}},m=class{constructor({anchorColors:t=g(),numPoints:e=4,positionFunction:r=p,positionFunctionX:n,positionFunctionY:s,positionFunctionZ:a,closedLoop:i,invertedLightness:l}={anchorColors:g(),numPoints:4,positionFunction:p,closedLoop:!1}){if(this._needsUpdate=!0,this._positionFunctionX=p,this._positionFunctionY=p,this._positionFunctionZ=p,this.connectLastAndFirstAnchor=!1,this._animationFrame=null,this._invertedLightness=!1,!t||t.length<2)throw Error("Must have at least two anchor colors");this._anchorPoints=t.map(t=>new f({color:t,invertedLightness:l})),this._numPoints=e+2,this._positionFunctionX=n||r||p,this._positionFunctionY=s||r||p,this._positionFunctionZ=a||r||p,this.connectLastAndFirstAnchor=i||!1,this._invertedLightness=l||!1,this.updateAnchorPairs()}get numPoints(){return this._numPoints-2}set numPoints(t){if(t<1)throw Error("Must have at least one point");this._numPoints=t+2,this.updateAnchorPairs()}set positionFunction(t){if(Array.isArray(t)){if(3!==t.length)throw Error("Position function array must have 3 elements");if("function"!=typeof t[0]||"function"!=typeof t[1]||"function"!=typeof t[2])throw Error("Position function array must have 3 functions");this._positionFunctionX=t[0],this._positionFunctionY=t[1],this._positionFunctionZ=t[2]}else this._positionFunctionX=t,this._positionFunctionY=t,this._positionFunctionZ=t;this.updateAnchorPairs()}get positionFunction(){return this._positionFunctionX===this._positionFunctionY&&this._positionFunctionX===this._positionFunctionZ?this._positionFunctionX:[this._positionFunctionX,this._positionFunctionY,this._positionFunctionZ]}set positionFunctionX(t){this._positionFunctionX=t,this.updateAnchorPairs()}get positionFunctionX(){return this._positionFunctionX}set positionFunctionY(t){this._positionFunctionY=t,this.updateAnchorPairs()}get positionFunctionY(){return this._positionFunctionY}set positionFunctionZ(t){this._positionFunctionZ=t,this.updateAnchorPairs()}get positionFunctionZ(){return this._positionFunctionZ}get anchorPoints(){return this._anchorPoints}set anchorPoints(t){this._anchorPoints=t,this.updateAnchorPairs()}updateAnchorPairs(){this._anchorPairs=[];let t=this.connectLastAndFirstAnchor?this.anchorPoints.length:this.anchorPoints.length-1;for(let e=0;e<t;e++){let t=[this.anchorPoints[e],this.anchorPoints[(e+1)%this.anchorPoints.length]];this._anchorPairs.push(t)}this.points=this._anchorPairs.map((t,e)=>{let r=t[0]?t[0].position:[0,0,0],n=t[1]?t[1].position:[0,0,0],s=this.shouldInvertEaseForSegment(e);return((t,e,r=4,n=!1,s=(t,e)=>e?1-t:t,a=(t,e)=>e?1-t:t,i=(t,e)=>e?1-t:t)=>{let l=[];for(let o=0;o<r;o++){let[d,c,u]=x(o/(r-1),t,e,n,s,a,i);l.push([d,c,u])}return l})(r,n,this._numPoints,!!s,this.positionFunctionX,this.positionFunctionY,this.positionFunctionZ).map(t=>new f({xyz:t,invertedLightness:this._invertedLightness}))})}addAnchorPoint({xyz:t,color:e,insertAtIndex:r}){let n=new f({xyz:t,color:e,invertedLightness:this._invertedLightness});return void 0!==r?this.anchorPoints.splice(r,0,n):this.anchorPoints.push(n),this.updateAnchorPairs(),n}removeAnchorPoint({point:t,index:e}){let r;if(!t&&void 0===e)throw Error("Must provide a point or index");if(this.anchorPoints.length<3)throw Error("Must have at least two anchor points");if(void 0!==e?r=e:t&&(r=this.anchorPoints.indexOf(t)),r>-1&&r<this.anchorPoints.length)this.anchorPoints.splice(r,1),this.updateAnchorPairs();else throw Error("Point not found")}updateAnchorPoint({point:t,pointIndex:e,xyz:r,color:n}){if(void 0!==e&&(t=this.anchorPoints[e]),!t)throw Error("Must provide a point or pointIndex");if(!r&&!n)throw Error("Must provide a new xyz position or color");return r&&(t.position=r),n&&(t.hsl=n),this.updateAnchorPairs(),t}getClosestAnchorPoint({xyz:t,hsl:e,maxDistance:r=1}){let n;if(!t&&!e)throw Error("Must provide a xyz or hsl");t?n=this.anchorPoints.map(e=>v(e.position,t)):e&&(n=this.anchorPoints.map(t=>v(t.hsl,e,!0)));let s=Math.min(...n);if(s>r)return null;let a=n.indexOf(s);return this.anchorPoints[a]||null}set closedLoop(t){this.connectLastAndFirstAnchor=t,this.updateAnchorPairs()}get closedLoop(){return this.connectLastAndFirstAnchor}set invertedLightness(t){this._invertedLightness=t,this.updateAnchorPairs()}get invertedLightness(){return this._invertedLightness}get flattenedPoints(){return this.points.flat().filter((t,e)=>0==e||e%this._numPoints)}get colors(){let t=this.flattenedPoints.map(t=>t.color);return this.connectLastAndFirstAnchor&&2!==this._anchorPoints.length&&t.pop(),t}cssColors(t="hsl"){let e=this.flattenedPoints.map({hsl:t=>t.hslCSS,oklch:t=>t.oklchCSS,lch:t=>t.lchCSS}[t]);return this.connectLastAndFirstAnchor&&e.pop(),e}get colorsCSS(){return this.cssColors("hsl")}get colorsCSSlch(){return this.cssColors("lch")}get colorsCSSoklch(){return this.cssColors("oklch")}shiftHue(t=20){this.anchorPoints.forEach(e=>e.shiftHue(t)),this.updateAnchorPairs()}getColorAt(t){var e;if(t<0||t>1)throw Error("Position must be between 0 and 1");if(0===this.anchorPoints.length)throw Error("No anchor points available");let r=this.connectLastAndFirstAnchor?this.anchorPoints.length:this.anchorPoints.length-1,n=this.connectLastAndFirstAnchor&&2===this.anchorPoints.length?2:r,s=t*n,a=Math.floor(s),i=a>=n?n-1:a,l=this._anchorPairs[i];return l&&!(l.length<2)&&l[0]&&l[1]?new f({xyz:x(a>=n?1:s-a,l[0].position,l[1].position,this.shouldInvertEaseForSegment(i),this._positionFunctionX,this._positionFunctionY,this._positionFunctionZ),invertedLightness:this._invertedLightness}):new f({color:(null==(e=this.anchorPoints[0])?void 0:e.color)||[0,0,0],invertedLightness:this._invertedLightness})}shouldInvertEaseForSegment(t){return!!(t%2||this.connectLastAndFirstAnchor&&2===this.anchorPoints.length&&0===t)}},{p5:w}=globalThis;if(w&&w.VERSION&&w.VERSION.startsWith("1.")){console.info("p5 < 1.x detected, adding poline to p5 prototype");let t=new m;w.prototype.poline=t;let e=()=>t.colors.map(t=>`hsl(${Math.round(t[0])},${100*t[1]}%,${100*t[2]}%)`);w.prototype.registerMethod("polineColors",e),globalThis.poline=t,globalThis.polineColors=e}var y=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-center hover:bg-bg-surface-raised"><div class="text-xs text-text-tertiary">subvolumes</div><div class="text-sm font-medium text-text-default">'),S=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-center hover:bg-bg-surface-raised"><div class="text-xs text-text-tertiary">backups</div><div class="text-sm font-medium text-text-default">'),C=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-center hover:bg-bg-surface-raised"><div class="text-xs text-text-tertiary">errors</div><div>'),Y=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-center hover:bg-bg-surface-raised"><div class="text-xs text-text-tertiary">scrub</div><div>'),k=(0,n.vs)("<span class=font-mono>"),P=(0,n.vs)('<div class=space-y-3><div class="grid grid-cols-4 gap-2"></div><div class="grid grid-cols-2 gap-2"><div class="bg-bg-surface border border-border-default"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle text-xs text-text-tertiary">filesystem</div><table class="w-full text-xs"><tbody></tbody></table></div><div class="bg-bg-surface border border-border-default"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle text-xs text-text-tertiary">last scrub'),$=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-center"><div class="text-xs text-text-tertiary">backups</div><div class="text-sm font-medium text-text-muted">-'),E=(0,n.vs)('<div class="px-2 py-1 text-xs text-text-muted">loading...'),R=(0,n.vs)('<div class="px-2 py-1 text-xs text-text-muted">never run'),z=(0,n.vs)("<span>"),F=(0,n.vs)("<span class=text-error>"),M=(0,n.vs)('<table class="w-full text-xs"><tbody>'),B=(0,n.vs)("<span class=text-success>none"),L=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-xs text-text-tertiary">loading usage...'),_=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-2 text-xs text-text-tertiary">loading devices...'),T=(0,n.vs)('<tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary">slack</td><td class="px-1.5 py-0.5 font-mono text-text-default text-right">'),A=(0,n.vs)('<div class="bg-bg-surface border border-border-default"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle text-xs text-text-tertiary">space & allocations</div><div class=flex><div class="p-2 border-r border-border-subtle"><div class="flex gap-2"style=height:120px></div></div><div class="flex-1 flex"><table class="text-xs flex-1"><tbody><tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary">total</td><td class="px-1.5 py-0.5 font-mono text-text-default text-right"></td></tr><tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary">allocated <span class=text-text-muted>(<!>%)</span></td><td class="px-1.5 py-0.5 font-mono text-text-default text-right"></td></tr><tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary">unallocated</td><td class="px-1.5 py-0.5 font-mono text-text-default text-right"></td></tr><tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary">used</td><td class="px-1.5 py-0.5 font-mono text-text-default text-right"></td></tr></tbody></table><table class="text-xs flex-1 border-l border-border-subtle"><tbody>'),I=(0,n.vs)('<div class="flex flex-col items-center h-full"><div class="w-5 flex-1 rounded overflow-hidden relative bg-bg-muted"><div class="absolute bottom-0 left-0 right-0 flex flex-col"></div></div><div class="text-[10px] text-text-tertiary mt-1 text-center leading-tight"><div class="font-medium text-text-default">%</div><div>'),Z=(0,n.vs)('<div class="w-full h-full">'),V=(0,n.vs)('<div class="w-full min-h-[1px]">'),D=(0,n.vs)('<div class="flex flex-col items-center h-full"><div class="w-5 flex-1 rounded overflow-hidden relative bg-bg-muted"><div class="absolute bottom-0 left-0 right-0"></div></div><div class="text-[10px] text-text-tertiary mt-1 text-center leading-tight"><div class="font-medium text-text-default">%</div><div>Free'),N=(0,n.vs)('<tr><td class="px-1.5 py-0.5 text-text-tertiary">reserve</td><td class="px-1.5 py-0.5 font-mono text-text-default text-right">/'),j=(0,n.vs)('<tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-tertiary"></td><td class="px-1.5 py-0.5 font-mono text-text-default text-right"><span class=text-text-muted>/'),O=(0,n.vs)('<tr class="border-b border-border-subtle"><td class="px-1.5 py-0.5 text-text-muted pl-3">profile</td><td class="px-1.5 py-0.5 text-text-tertiary text-right"> <span class=text-text-muted>(<!>x)'),q=(0,n.vs)('<div class="bg-bg-surface border border-border-default"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle text-xs text-text-tertiary">devices</div><div class="divide-y divide-border-subtle">'),U=(0,n.vs)('<span class="text-text-muted text-[10px]">id:'),X=(0,n.vs)('<span class="text-error text-[10px]"> errors'),H=(0,n.vs)('<div class=p-2><div class="flex items-center justify-between text-xs mb-1"><div class="flex items-center gap-2"><span class="font-mono text-text-default"></span></div><div class="flex items-center gap-2"><span class=text-text-tertiary></span></div></div><div class="h-2 bg-bg-muted rounded overflow-hidden flex mb-1"></div><div class="flex flex-wrap gap-x-3 text-[10px] text-text-tertiary">'),K=(0,n.vs)('<span class="text-success text-[10px]">0 errors'),G=(0,n.vs)('<div class="h-full border-r border-bg-surface/50 last:border-r-0 hover:brightness-110 transition-all cursor-pointer">'),W=(0,n.vs)('<span><span class="inline-block w-2 h-2 rounded-sm mr-0.5"></span> '),J=(0,n.vs)('<span><span class="inline-block w-2 h-2 rounded-sm mr-0.5"></span>Free ');let Q={Data:[[210,.8,.4],[220,.55,.65]],Metadata:[[145,.7,.35],[155,.5,.6]],System:[[30,.85,.45],[40,.6,.6]],Unallocated:[[280,.5,.45],[290,.35,.65]]};function tt(t){let[e,r,n]=(Q[t]||Q.Data)[1];return`hsl(${e}, ${100*r}%, ${100*n}%)`}function te(t){var e,r,l,u,h;let[g,{refetch:x}]=(0,s.Zg)(()=>t.fs.path,t=>i.bx.getFilesystemUsage({devicePath:t}).then(t=>t.usage)),[p,{refetch:b}]=(0,s.Zg)(()=>t.fs.path,t=>i.qy.listSubvolumes({mountPath:t}).then(t=>t.subvolumes)),[v,{refetch:f}]=(0,s.Zg)(()=>t.fs.path,t=>i.ZV.getScrubStatus({devicePath:t})),[m,{refetch:w}]=(0,s.Zg)(()=>t.fs.path,t=>i.bx.getErrors({device:t,limit:1e3}).then(t=>t.errors)),[T,{refetch:A}]=(0,s.Zg)(()=>t.fs.path,t=>i.bx.getDeviceStats({devicePath:t}).then(t=>t.devices));(0,s.Rc)(()=>{let t=()=>{x(),b(),f(),w(),A()};window.addEventListener("fs-refresh",t),(0,s.Ki)(()=>window.removeEventListener("fs-refresh",t))});let I=()=>(0,o.mH)().showRawBytes,Z=(0,s.To)(()=>{let e=p.latest;return e?e.length-(0,d.BH)(e,t.fs.btrbkSnapshotDir):0}),V=(0,s.To)(()=>{let e=p.latest;return e?(0,d.BH)(e,t.fs.btrbkSnapshotDir):0}),D=(0,s.To)(()=>{var t;return(null==(t=m.latest)?void 0:t.length)??0}),N=(0,s.To)(()=>{let t=v.latest;if(!t)return{text:"...",class:"text-text-muted"};if(t.isRunning)return{text:"running",class:"text-primary"};if(!t.progress)return{text:"never run",class:"text-text-muted"};let e=t.progress,r=e.uncorrectableErrors>0||e.readErrors>0||e.csumErrors>0;return"finished"===e.status?r?{text:"errors found",class:"text-error"}:{text:"ok",class:"text-success"}:{text:e.status||"unknown",class:"text-text-tertiary"}}),j=(0,s.To)(()=>{let t=T.latest,e=g.latest,r=0;if(e){let t=new Set;for(let r of e.allocations)for(let e of r.devices)t.add(e.devicePath);r=t.size}return Math.max((null==t?void 0:t.length)||0,r)});return u=(l=(r=(e=P()).firstChild).nextSibling.firstChild).firstChild.nextSibling.firstChild,(h=l.nextSibling).firstChild,(0,n.Yr)(r,(0,s.a0)(a.A,{get href(){return`/fs/${t.fs.id}/subvolumes`},class:"block",get children(){var O=y(),q=O.firstChild.nextSibling;return(0,n.Yr)(q,()=>(0,d.ZV)(Z())),O}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return t.fs.btrbkSnapshotDir},get fallback(){return $()},get children(){return(0,s.a0)(a.A,{get href(){return`/fs/${t.fs.id}/subvolumes`},class:"block",get children(){var U=S(),X=U.firstChild.nextSibling;return(0,n.Yr)(X,()=>(0,d.ZV)(V())),U}})}}),null),(0,n.Yr)(r,(0,s.a0)(a.A,{get href(){return`/fs/${t.fs.id}/errors`},class:"block",get children(){var H=C(),K=H.firstChild.nextSibling;return(0,n.Yr)(K,()=>(0,d.ZV)(D())),(0,s.gb)(()=>(0,n.s7)(K,`text-sm font-medium ${D()>0?"text-error":"text-success"}`)),H}}),null),(0,n.Yr)(r,(0,s.a0)(a.A,{get href(){return`/fs/${t.fs.id}/maintenance`},class:"block",get children(){var G=Y(),W=G.firstChild.nextSibling;return(0,n.Yr)(W,()=>N().text),(0,s.gb)(()=>(0,n.s7)(W,`text-sm font-medium ${N().class}`)),G}}),null),(0,n.Yr)(u,(0,s.a0)(c.jP,{label:"path",align:"top",get children(){var J=k();return(0,n.Yr)(J,()=>t.fs.path),J}}),null),(0,n.Yr)(u,(0,s.a0)(s.wv,{get when(){return t.fs.label},get children(){return(0,s.a0)(c.jP,{label:"label",align:"top",get children(){return t.fs.label}})}}),null),(0,n.Yr)(u,(0,s.a0)(s.wv,{get when(){return t.fs.btrbkSnapshotDir},get children(){return(0,s.a0)(c.jP,{label:"btrbk",align:"top",get children(){var Q=k();return(0,n.Yr)(Q,()=>t.fs.btrbkSnapshotDir),Q}})}}),null),(0,n.Yr)(u,(0,s.a0)(c.jP,{label:"devices",align:"top",get children(){return(0,d.ZV)(j())}}),null),(0,n.Yr)(h,(0,s.a0)(s.tY,{get fallback(){return E()},get children(){return(0,s.a0)(s.wv,{get when(){return v()},get fallback(){return E()},children:t=>(0,s.a0)(s.wv,{get when(){return t().progress},get fallback(){return R()},children:t=>{var e,r;return r=(e=M()).firstChild,(0,n.Yr)(r,(0,s.a0)(c.jP,{label:"status",align:"top",get children(){var a=z();return(0,n.Yr)(a,()=>N().text),(0,s.gb)(()=>(0,n.s7)(a,N().class)),a}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return t().startedAt>0n},get children(){return(0,s.a0)(c.jP,{label:"started",align:"top",get children(){return new Date(1e3*Number(t().startedAt)).toLocaleString()}})}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return t().duration},get children(){return(0,s.a0)(c.jP,{label:"duration",align:"top",get children(){return t().duration}})}}),null),(0,n.Yr)(r,(0,s.a0)(c.jP,{label:"errors",align:"top",get children(){return(0,s.a0)(s.wv,{get when(){return t().uncorrectableErrors>0||t().readErrors>0||t().csumErrors>0},get fallback(){return B()},get children(){var i,l,o,u=F();return(0,n.Yr)(u,(i=(0,n.ph)(()=>t().uncorrectableErrors>0),()=>i()&&`uncorrectable:${(0,d.ZV)(t().uncorrectableErrors)} `),null),(0,n.Yr)(u,(l=(0,n.ph)(()=>t().readErrors>0),()=>l()&&`read:${(0,d.ZV)(t().readErrors)} `),null),(0,n.Yr)(u,(o=(0,n.ph)(()=>t().csumErrors>0),()=>o()&&`csum:${(0,d.ZV)(t().csumErrors)}`),null),u}})}}),null),e}})})}}),null),(0,n.Yr)(e,(0,s.a0)(s.tY,{get fallback(){return L()},get children(){return(0,s.a0)(s.wv,{get when(){return g()},children:t=>(0,s.a0)(tr,{get usage(){return t()},get showRaw(){return I()}})})}}),null),(0,n.Yr)(e,(0,s.a0)(s.tY,{get fallback(){return _()},get children(){return(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!T())()&&g()},get children(){return(0,s.a0)(tn,{get usage(){return g()},get deviceStats(){return T()},get showRaw(){return I()}})}})}}),null),e}function tr(t){var e,r,a,i,l,o,u,h,g,x,p,b,v,f,w,y;let S=(0,s.To)(()=>{let e=new Map;for(let r of t.usage.allocations)if(r.devices&&0!==r.devices.length)for(let[t,n]of function(t,e){let r=new Map,n=t.length;if(0===n)return r;let s=Q[e]||Q.Data;if(1===n){let[e,n,a]=s[0];return r.set(t[0],`hsl(${e}, ${100*n}%, ${100*a}%)`),r}let a=function(t){if(t.length<=2)return t;let e=[],r=Math.ceil(t.length/2);for(let n=0;n<r;n++)e.push(t[n]),n+r<t.length&&e.push(t[n+r]);return e}(new m({anchorColors:s,numPoints:n}).colorsCSS);return t.forEach((t,e)=>r.set(t,a[e]||"#6b7280")),r}(r.devices.map(t=>t.devicePath),r.type))e.set(`${r.type}:${t}`,n);return e}),C=(0,s.To)(()=>({total:t.usage.deviceSize,allocated:t.usage.deviceAllocated,unallocated:t.usage.deviceUnallocated,used:t.usage.used})),Y=(0,s.To)(()=>{let t=C();return 0n===t.total?0:Number(100n*t.allocated/t.total)}),k=(0,s.To)(()=>t.usage.allocations.filter(t=>"GlobalReserve"!==t.type&&!t.type.toLowerCase().includes("free"))),P=(0,s.To)(()=>t.usage.allocations.find(t=>"GlobalReserve"===t.type));return a=(r=(e=A()).firstChild.nextSibling.firstChild).firstChild,u=(o=(l=(i=r.nextSibling.firstChild).firstChild).firstChild).firstChild.nextSibling,(p=(x=(g=(h=o.nextSibling).firstChild).firstChild.nextSibling).firstChild.nextSibling).nextSibling,b=g.nextSibling,f=(v=h.nextSibling).firstChild.nextSibling,w=v.nextSibling.firstChild.nextSibling,y=i.nextSibling.firstChild,(0,n.Yr)(a,(0,s.a0)(s.a,{get each(){return k().filter(t=>"Unallocated"!==t.type)},children:t=>{let e=()=>t.size>0n?Number(100n*t.used/t.size):0;return(0,s.a0)(c.m_,{get text(){return`${t.type} (${t.profile}): ${(0,d.z3)(t.used)} / ${(0,d.z3)(t.size)} (${e()}%)
${t.devices.map(t=>`${t.devicePath.split("/").pop()}: ${(0,d.z3)(t.size)}`).join(" • ")}`},get children(){var r=I(),a=r.firstChild,i=a.firstChild,l=a.nextSibling.firstChild,o=l.firstChild,u=l.nextSibling;return(0,n.Yr)(i,(0,s.a0)(s.wv,{get when(){return t.devices.length>0},get fallback(){var h;return h=Z(),(0,s.gb)(e=>(0,n.$h)(h,"background-color",tt(t.type))),h},get children(){return(0,s.a0)(s.a,{get each(){return t.devices},children:e=>{var r;return r=V(),(0,s.gb)(s=>{let a,i;var l=Number(e.size),o=(a=t.type,i=e.devicePath,S().get(`${a}:${i}`)||"#6b7280");return l!==s.e&&(0,n.$h)(r,"flex-grow",s.e=l),o!==s.t&&(0,n.$h)(r,"background-color",s.t=o),s},{e:void 0,t:void 0}),r}})}})),(0,n.Yr)(l,e,o),(0,n.Yr)(u,()=>t.type.slice(0,4)),(0,s.gb)(t=>{var r=`${e()}%`,s=e()>0?"2px":"0";return r!==t.e&&(0,n.$h)(i,"height",t.e=r),s!==t.t&&(0,n.$h)(i,"min-height",t.t=s),t},{e:void 0,t:void 0}),r}})}}),null),(0,n.Yr)(a,()=>{let e=t.usage.allocations.find(t=>"Unallocated"===t.type);if(!e)return null;let r=()=>e.devices.reduce((t,e)=>t+e.size,0n),a=()=>C().total>0n?Number(100n*r()/C().total):0;return(0,s.a0)(c.m_,{get text(){return`Unallocated: ${(0,d.z3)(r())} (${a()}% of total)`},get children(){var i=D(),l=i.firstChild,o=l.firstChild,u=l.nextSibling.firstChild,h=u.firstChild;return(0,n.Yr)(u,a,h),(0,s.gb)(t=>{var e=`${a()}%`,r=a()>0?"2px":"0",s=tt("Unallocated");return e!==t.e&&(0,n.$h)(o,"height",t.e=e),r!==t.t&&(0,n.$h)(o,"min-height",t.t=r),s!==t.a&&(0,n.$h)(o,"background-color",t.a=s),t},{e:void 0,t:void 0,a:void 0}),i}})},null),(0,n.Yr)(u,(0,s.a0)(c.OV,{get bytes(){return C().total},get showRaw(){return t.showRaw}})),(0,n.Yr)(x,Y,p),(0,n.Yr)(b,(0,s.a0)(c.OV,{get bytes(){return C().allocated},get showRaw(){return t.showRaw}})),(0,n.Yr)(f,(0,s.a0)(c.OV,{get bytes(){return C().unallocated},get showRaw(){return t.showRaw}})),(0,n.Yr)(w,(0,s.a0)(c.OV,{get bytes(){return C().used},get showRaw(){return t.showRaw}})),(0,n.Yr)(l,(0,s.a0)(s.wv,{get when(){return t.usage.deviceSlack>0n},get children(){var $=T(),E=$.firstChild.nextSibling;return(0,n.Yr)(E,(0,s.a0)(c.OV,{get bytes(){return t.usage.deviceSlack},get showRaw(){return t.showRaw}})),$}}),null),(0,n.Yr)(l,(0,s.a0)(s.wv,{get when(){return P()},children:e=>{var r,a,i;return i=(a=(r=N()).firstChild.nextSibling).firstChild,(0,n.Yr)(a,(0,s.a0)(c.OV,{get bytes(){return e().used},get showRaw(){return t.showRaw}}),i),(0,n.Yr)(a,(0,s.a0)(c.OV,{get bytes(){return e().size},get showRaw(){return t.showRaw}}),null),r}}),null),(0,n.Yr)(y,(0,s.a0)(s.a,{get each(){return k().filter(t=>"Unallocated"!==t.type)},children:e=>{var r,a,i,l,o,d,u,h,g;return[(l=(i=(a=(r=j()).firstChild).nextSibling).firstChild,(0,n.Yr)(a,()=>e.type.toLowerCase()),(0,n.Yr)(i,(0,s.a0)(c.OV,{get bytes(){return e.used},get showRaw(){return t.showRaw}}),l),(0,n.Yr)(i,(0,s.a0)(c.OV,{get bytes(){return e.size},get showRaw(){return t.showRaw}}),null),r),((g=(h=(u=(d=(o=O()).firstChild.nextSibling).firstChild).nextSibling).firstChild.nextSibling).nextSibling,(0,n.Yr)(d,()=>e.profile,u),(0,n.Yr)(h,()=>"Data"===e.type?t.usage.dataRatio:t.usage.metadataRatio,g),o)]}})),e}function tn(t){var e,r;let a=(0,s.To)(()=>{if(t.deviceStats.length>0&&t.deviceStats[0].devicePath&&"total"!==t.deviceStats[0].devicePath)return t.deviceStats.map(t=>({path:t.devicePath,totalBytes:t.totalBytes,deviceId:t.deviceId,writeErrors:t.writeErrors,readErrors:t.readErrors,flushErrors:t.flushErrors,corruptionErrors:t.corruptionErrors,generationErrors:t.generationErrors}));let e=new Map;for(let r of t.usage.allocations)for(let t of r.devices)t.devicePath&&e.set(t.devicePath,(e.get(t.devicePath)||0n)+t.size);return 0===e.size?[{path:"all devices",totalBytes:t.usage.deviceSize,deviceId:void 0,writeErrors:0n,readErrors:0n,flushErrors:0n,corruptionErrors:0n,generationErrors:0n}]:Array.from(e.entries()).map(t=>{let[e,r]=t;return{path:e,totalBytes:r,deviceId:void 0,writeErrors:0n,readErrors:0n,flushErrors:0n,corruptionErrors:0n,generationErrors:0n}})});return r=(e=q()).firstChild.nextSibling,(0,n.Yr)(r,(0,s.a0)(s.a,{get each(){return a()},children:e=>{var r,a,i,l,o,u,h,g;let x=()=>{var r;return"all devices"===(r=e.path)?t.usage.allocations.filter(t=>"GlobalReserve"!==t.type).map(t=>({type:t.type,profile:t.profile,size:t.size})):t.usage.allocations.map(t=>{if(!t.devices||0===t.devices.length)return null;let e=t.devices.find(t=>t.devicePath===r);return e?{type:t.type,profile:t.profile,size:e.size}:null}).filter(Boolean)},p=()=>e.writeErrors+e.readErrors+e.flushErrors+e.corruptionErrors+e.generationErrors;return l=(i=(a=(r=H()).firstChild).firstChild).firstChild,u=(o=i.nextSibling).firstChild,g=(h=a.nextSibling).nextSibling,(0,n.Yr)(l,()=>e.path),(0,n.Yr)(i,(0,s.a0)(s.wv,{get when(){return e.deviceId},get children(){var b=U();return b.firstChild,(0,n.Yr)(b,()=>e.deviceId,null),b}}),null),(0,n.Yr)(o,(0,s.a0)(s.wv,{get when(){return p()>0n},get fallback(){return K()},get children(){return(0,s.a0)(c.m_,{get text(){return`write:${(0,d.ZV)(e.writeErrors)} read:${(0,d.ZV)(e.readErrors)} flush:${(0,d.ZV)(e.flushErrors)} corruption:${(0,d.ZV)(e.corruptionErrors)} generation:${(0,d.ZV)(e.generationErrors)}`},get children(){var v=X(),f=v.firstChild;return(0,n.Yr)(v,()=>(0,d.ZV)(p()),f),v}})}}),u),(0,n.Yr)(u,(0,s.a0)(c.OV,{get bytes(){return e.totalBytes},get showRaw(){return t.showRaw}})),(0,n.Yr)(h,(0,s.a0)(s.a,{get each(){return x()},children:t=>{var e;return e=G(),(0,s.gb)(r=>{let s;var a,i=`${t.type}: ${(0,d.z3)(t.size)}`,l=`${(a=t.size,0n===(s=x().reduce((t,e)=>t+e.size,0n))?0:Number(10000n*a/s)/100)}%`,o=tt(t.type);return i!==r.e&&(0,n.Bq)(e,"title",r.e=i),l!==r.t&&(0,n.$h)(e,"width",r.t=l),o!==r.a&&(0,n.$h)(e,"background-color",r.a=o),r},{e:void 0,t:void 0,a:void 0}),e}})),(0,n.Yr)(g,(0,s.a0)(s.a,{get each(){return x().filter(t=>"Unallocated"!==t.type)},children:t=>{var e,r,a;return a=(r=(e=W()).firstChild).nextSibling,(0,n.Yr)(e,()=>t.type.slice(0,4),a),(0,n.Yr)(e,()=>(0,d.z3)(t.size),null),(0,s.gb)(e=>(0,n.$h)(r,"background-color",tt(t.type))),e}}),null),(0,n.Yr)(g,()=>{var t,e;let r=x().find(t=>"Unallocated"===t.type);return r?((e=(t=J()).firstChild).nextSibling,(0,n.Yr)(t,()=>(0,d.z3)(r.size),null),(0,s.gb)(t=>(0,n.$h)(e,"background-color",tt("Unallocated"))),t):null},null),r}})),e}var ts=r(353),ta=(0,n.vs)(`<span class=animate-spin>◌`),ti=(0,n.vs)('<div class="relative hover:bg-bg-surface-raised group"><div class="absolute inset-y-0 left-0 bg-primary-subtle"></div><div><span class="w-4 text-text-muted text-xs flex-shrink-0"></span><span class="w-5 text-text-muted text-xs flex-shrink-0"></span><span class="flex-1 text-xs font-mono text-text-default truncate"></span><div class="flex items-center space-x-3 text-xs flex-shrink-0 whitespace-nowrap"><span class="w-12 text-right text-text-secondary">%</span><span class="w-20 text-right font-mono text-text-tertiary"></span><span class="w-16 text-right font-mono text-text-muted">'),tl=(0,n.vs)("<span class=w-4>"),to=(0,n.vs)(`<span class="inline-block transition-transform">▶`),td=(0,n.vs)('<div><span class=text-text-tertiary>samples </span><span class="font-mono text-text-default">'),tc=(0,n.vs)('<div><span class=text-text-tertiary>size </span><span class="font-mono text-text-default">'),tu=(0,n.vs)('<div><span class=text-text-tertiary>time </span><span class="font-mono text-text-default">'),th=(0,n.vs)('<div><span class=text-text-tertiary>rate </span><span class="font-mono text-text-default">/s'),tg=(0,n.vs)('<span class="text-xs text-text-muted animate-pulse">loading...'),tx=(0,n.vs)('<button class="px-2 py-1 text-xs cursor-pointer bg-error text-text-inverse hover:bg-error-hover">stop'),tp=(0,n.vs)('<div class="h-1 bg-bg-base"><div class="h-1 bg-primary-soft animate-pulse w-full">'),tb=(0,n.vs)('<div class="px-3 py-1 text-xs text-text-tertiary font-mono truncate border-t border-border-subtle">'),tv=(0,n.vs)(`<div class="bg-bg-surface border border-border-default"><div class="flex items-center py-1 pr-2 border-b border-border-subtle bg-bg-surface-raised text-xs"style=padding-left:8px><button class="w-4 flex-shrink-0 text-text-muted hover:text-text-default cursor-pointer"title="Reset sort to size descending">↺</button><span class="w-5 flex-shrink-0"></span><button>path <span class="text-text-muted ml-2">(<!> items)</span></button><div class="flex items-center space-x-3 flex-shrink-0 whitespace-nowrap"><span class="w-12 text-right text-text-tertiary">%</span><button>size </button><button>samples </button></div></div><div class="divide-y divide-border-subtle">`),tf=(0,n.vs)('<div class=space-y-2><div class="bg-bg-surface border border-border-default"><div class="flex items-center justify-between px-3 py-2 border-b border-border-subtle"><div class="flex items-center space-x-4 text-xs"></div><div class="flex items-center space-x-2"><button>'),tm=(0,n.vs)('<div class="flex items-center"><span class=text-text-tertiary>samples </span><span class="w-12 h-3 bg-bg-muted rounded animate-pulse ml-1">'),tw=(0,n.vs)('<div class="flex items-center"><span class=text-text-tertiary>size </span><span class="w-14 h-3 bg-bg-muted rounded animate-pulse ml-1">'),ty=(0,n.vs)('<div class="flex items-center"><span class=text-text-tertiary>time </span><span class="w-10 h-3 bg-bg-muted rounded animate-pulse ml-1">'),tS=(0,n.vs)('<button class="px-2 py-1 text-xs cursor-pointer bg-interactive-soft text-text-inverse hover:bg-interactive">clear'),tC=(0,n.vs)('<div class="flex space-x-1"><button class="px-2 py-1 text-xs cursor-pointer bg-primary text-text-inverse hover:bg-primary-hover">'),tY=(0,n.vs)('<div class="bg-bg-surface border border-border-default p-4 text-xs text-text-tertiary text-center">'),tk=(0,n.vs)(`<div class="flex items-center justify-center space-x-2"><span class=animate-spin>◌</span><span>`);function tP(t){var e,r,a,l,c;let u,h,g,[x,p]=(0,s.n5)("size"),[b,v]=(0,s.n5)(!0),[f,m]=(0,s.n5)(!1),[w,y]=(0,ts.y$)([]),[S,C]=(0,s.n5)(new Set),Y="",[k,P]=(0,s.n5)(null),[$,E]=(0,s.n5)(!0),[R,z]=(0,s.n5)(!1),F=async()=>{try{let e=await i.B3.getSamplingStatus({fsPath:t.fs.path});return P(e),e}catch(t){return console.error("Failed to fetch status:",t),null}finally{E(!1)}},[M,B]=(0,s.n5)(0n),[L,_]=(0,s.n5)(0n),T=async e=>{let r=await i.B3.getUsageTree({fsPath:t.fs.path,path:e,sortBy:x(),sortDesc:b(),limit:100});"/"===e&&(r.totalSize&&B(r.totalSize),r.totalSamples&&_(r.totalSamples));let n=L()||r.totalSamples||1n;return(r.children??[]).map(t=>({name:t.name,fullPath:t.fullPath,isDir:t.isDir,samples:t.samples,estimatedSize:t.estimatedSize,percentage:n>0n?Number(10000n*t.samples/n)/100:0,childCount:t.childCount}))},A=async()=>{var t;if(!(null==(t=k())?void 0:t.hasSession))return void y((0,ts.Lq)([]));z(!0);try{let t=await T("/");y((0,ts.Lq)(t))}finally{z(!1)}};(0,s.Rc)(()=>{F().then(()=>A()),u=setInterval(async()=>{var t,e;if(f())return;let r=await F();if(!r)return;let n=r.sessionId??"";n!==Y?(Y=n,null==(t=r.progress)||t.sampleCount,await I()):null==(e=r.progress)||e.sampleCount},1e3),h=setInterval(async()=>{var t;if(f())return;let e=k();!e||(null==(t=e.progress)?void 0:t.isRunning)&&w.length>0&&await I()},3e3)}),(0,s.Ki)(()=>{u&&clearInterval(u),h&&clearInterval(h)});let I=async()=>{let t=S(),e=await T("/"),r=await Z(e,t);y((0,ts.Lq)(r))},Z=async(t,e)=>Promise.all(t.map(async t=>{if(e.has(t.fullPath)&&t.childCount>0){let r=await T(t.fullPath);return{...t,expanded:!0,children:await Z(r,e)}}return t})),[V,D]=(0,s.n5)({sampleCount:0,totalSize:0n,isRunning:!1,hasSession:!1,samplesPerSec:0,currentPath:"",sessionId:"",runningTimeSeconds:0n}),[N,j]=(0,s.n5)([]),[O,q]=(0,s.n5)(0);(0,s.Rc)(()=>{g=setInterval(()=>{let t=N();t.length>0&&q(e=>e>=t.length-1?e:e+1)},60)}),(0,s.Ki)(()=>{g&&clearInterval(g)}),(0,s.To)(()=>{let t=k();if(t){var e,r,n,s,a,i,l;let o={sampleCount:Number((null==(e=t.progress)?void 0:e.sampleCount)??0n),totalSize:(null==(r=t.progress)?void 0:r.totalSize)??0n,isRunning:(null==(n=t.progress)?void 0:n.isRunning)??!1,hasSession:t.hasSession??!1,samplesPerSec:(null==(s=t.progress)?void 0:s.samplesPerSecond)??0,currentPath:(null==(a=t.progress)?void 0:a.currentPath)??"",sessionId:t.sessionId??"",runningTimeSeconds:(null==(i=t.progress)?void 0:i.runningTimeSeconds)??0n},d=V();(o.sampleCount!==d.sampleCount||o.isRunning!==d.isRunning||o.hasSession!==d.hasSession||o.sessionId!==d.sessionId||o.totalSize!==d.totalSize||o.runningTimeSeconds!==d.runningTimeSeconds)&&D(o);let c=(null==(l=t.progress)?void 0:l.recentPaths)??[];c.length>0&&(j(c),q(0))}});let U=(0,s.To)(()=>{let t=Number(V().runningTimeSeconds);if(t<=0)return"0s";let e=Math.floor(t/60),r=t%60;return e>0?`${e}m ${r}s`:`${r}s`}),X=(0,s.To)(()=>0===w.length?1n:w.reduce((t,e)=>e.samples>t?e.samples:t,1n)),H=t=>{x()===t?v(!b()):(p(t),v(!0)),I()},K=async()=>{try{await i.B3.startSampling({fsPath:t.fs.path,resume:!0}),F(),setTimeout(A,500)}catch(t){console.error("Failed to start sampling:",t)}},G=async()=>{try{await i.B3.stopSampling({fsPath:t.fs.path}),F()}catch(t){console.error("Failed to stop sampling:",t)}},W=async()=>{try{await i.B3.clearSampling({fsPath:t.fs.path}),y((0,ts.Lq)([])),C(new Set),B(0n),_(0n),F()}catch(t){console.error("Failed to clear sampling:",t)}},J=async(t,e)=>{if(0===e.childCount)return;let r=new Set(S());if(e.expanded)r.delete(e.fullPath),C(r),Q(t,{...e,expanded:!1,children:void 0});else{r.add(e.fullPath),C(r),Q(t,{...e,loading:!0});try{let r=await T(e.fullPath);Q(t,{...e,expanded:!0,loading:!1,children:r})}catch(n){console.error("Failed to load children:",n),Q(t,{...e,loading:!1}),r.delete(e.fullPath),C(r)}}},Q=(t,e)=>{y((0,ts.jM)(r=>{let n=r;for(let e=0;e<t.length-1;e++){let r=n[t[e]];if(null==r||!r.children)return;n=r.children}let s=t[t.length-1];n[s]&&Object.assign(n[s],e)}))},tt=t=>{var e,r,a,i,l,c,u,h,g,x;return[(h=(u=(c=(l=(i=(a=(r=(e=ti()).firstChild).nextSibling).firstChild).nextSibling).nextSibling).nextSibling.firstChild).firstChild,x=(g=u.nextSibling).nextSibling,a.$$click=()=>t.node.childCount>0&&J(t.path,t.node),(0,n.Yr)(i,(0,s.a0)(s.wv,{get when(){return t.node.childCount>0},get fallback(){return tl()},get children(){return(0,s.a0)(s.wv,{get when(){return t.node.loading},get fallback(){var p;return p=to(),(0,s.gb)(()=>p.classList.toggle("rotate-90",!!t.node.expanded)),p},get children(){return ta()}})}})),(0,n.Yr)(l,()=>t.node.childCount>0?"\uD83D\uDCC1":"\uD83D\uDCC4"),(0,n.Yr)(c,()=>t.node.fullPath),(0,n.Yr)(u,()=>t.node.percentage.toFixed(1),h),(0,n.Yr)(g,()=>(0,d.z3)(t.node.estimatedSize,(0,o.mH)().showRawBytes)),(0,n.Yr)(x,()=>Number(t.node.samples).toLocaleString()),(0,s.gb)(e=>{var s=`${Number(100n*t.node.samples/t.maxSamples)}%`,i=`relative flex items-center py-1 pr-2 ${t.node.childCount>0?"cursor-pointer":""}`,l=`${16*t.depth+8}px`,o=t.node.fullPath;return s!==e.e&&(0,n.$h)(r,"width",e.e=s),i!==e.t&&(0,n.s7)(a,e.t=i),l!==e.a&&(0,n.$h)(a,"padding-left",e.a=l),o!==e.o&&(0,n.Bq)(c,"title",e.o=o),e},{e:void 0,t:void 0,a:void 0,o:void 0}),e),(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.node.expanded)()&&t.node.children},get children(){return(0,s.a0)(s.a,{get each(){return t.node.children},children:(e,r)=>(0,s.a0)(tt,{node:e,get depth(){return t.depth+1},get path(){return[...t.path,r()]},get maxSamples(){return t.maxSamples}})})}})]};return c=(l=(a=(r=(e=tf()).firstChild).firstChild.firstChild).nextSibling).firstChild,(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return!$()},get fallback(){return[tm(),tw(),ty()]},get children(){var te,tr,tn,tP,t$,tE;return[(tr=(te=td()).firstChild.nextSibling,(0,n.Yr)(tr,()=>V().sampleCount.toLocaleString()),te),(tP=(tn=tc()).firstChild.nextSibling,(0,n.Yr)(tP,()=>(0,d.z3)(V().totalSize,(0,o.mH)().showRawBytes)),tn),(tE=(t$=tu()).firstChild.nextSibling,(0,n.Yr)(tE,U),t$),(0,s.a0)(s.wv,{get when(){return V().isRunning},get children(){var tR=th(),tz=tR.firstChild.nextSibling,tF=tz.firstChild;return(0,n.Yr)(tz,()=>V().samplesPerSec.toFixed(0),tF),tR}})]}})),c.$$click=()=>m(!f()),(0,n.Yr)(c,()=>f()?"paused":"live"),(0,n.Yr)(l,(0,s.a0)(s.wv,{get when(){return $()},get children(){return tg()}}),null),(0,n.Yr)(l,(0,s.a0)(s.wv,{get when(){return!$()},get children(){return(0,s.a0)(s.wv,{get when(){return V().isRunning},get fallback(){var tM,tB;return(tB=(tM=tC()).firstChild).$$click=K,(0,n.Yr)(tB,()=>V().hasSession?"resume":"start"),(0,n.Yr)(tM,(0,s.a0)(s.wv,{get when(){return V().hasSession},get children(){var tL=tS();return tL.$$click=W,tL}}),null),tM},get children(){var t_=tx();return t_.$$click=G,t_}})}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return V().isRunning},get children(){var tT;return[tp(),(tT=tb(),(0,n.Yr)(tT,()=>{let t;return(0===(t=N()).length?V().currentPath:t[O()%t.length]||V().currentPath)||"sampling..."}),tT)]}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return w.length>0},get fallback(){var tA;return tA=tY(),(0,n.Yr)(tA,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!$())()&&!R()},get fallback(){var tI,tZ;return tZ=(tI=tk()).firstChild.nextSibling,(0,n.Yr)(tZ,()=>$()?"checking for existing session...":"loading tree data..."),tI},get children(){return V().hasSession?"no data yet":"click start to begin sampling"}})),tA},get children(){var tV,tD,tN,tj=tv(),tO=tj.firstChild,tq=tO.firstChild,tU=tq.nextSibling.nextSibling,tX=tU.firstChild.nextSibling,tH=tX.firstChild.nextSibling,tK=(tH.nextSibling,tU.nextSibling).firstChild.nextSibling,tG=(tK.firstChild,tK.nextSibling),tW=(tG.firstChild,tO.nextSibling);return tq.$$click=()=>{p("size"),v(!0),I()},tU.$$click=()=>H("name"),(0,n.Yr)(tU,(tV=(0,n.ph)(()=>"name"===x()),()=>tV()&&(b()?"↓":"↑")),tX),(0,n.Yr)(tX,()=>w.length.toLocaleString(),tH),tK.$$click=()=>H("size"),(0,n.Yr)(tK,(tD=(0,n.ph)(()=>"size"===x()),()=>tD()&&(b()?"↓":"↑")),null),tG.$$click=()=>H("samples"),(0,n.Yr)(tG,(tN=(0,n.ph)(()=>"samples"===x()),()=>tN()&&(b()?"↓":"↑")),null),(0,n.Yr)(tW,(0,s.a0)(s.a,{each:w,children:(t,e)=>(0,s.a0)(tt,{node:t,depth:0,get path(){return[e()]},get maxSamples(){return X()}})})),(0,s.gb)(t=>{var e=`flex-1 text-left cursor-pointer hover:text-text-default ${"name"===x()?"text-text-default font-medium":"text-text-tertiary"}`,r=`w-20 text-right cursor-pointer hover:text-text-default ${"size"===x()?"text-text-default font-medium":"text-text-tertiary"}`,s=`w-16 text-right cursor-pointer hover:text-text-default ${"samples"===x()?"text-text-default font-medium":"text-text-tertiary"}`;return e!==t.e&&(0,n.s7)(tU,t.e=e),r!==t.t&&(0,n.s7)(tK,t.t=r),s!==t.a&&(0,n.s7)(tG,t.a=s),t},{e:void 0,t:void 0,a:void 0}),tj}}),null),(0,s.gb)(t=>{var e=`px-2 py-1 text-xs cursor-pointer ${f()?"bg-warning-soft text-text-inverse hover:bg-warning":"bg-bg-muted text-text-secondary hover:bg-border-strong"}`,r=f()?"Resume auto-refresh":"Pause auto-refresh",s=$();return e!==t.e&&(0,n.s7)(c,t.e=e),r!==t.t&&(0,n.Bq)(c,"title",t.t=r),s!==t.a&&(c.disabled=t.a=s),t},{e:void 0,t:void 0,a:void 0}),e}(0,n.z_)(["click"]);var t$=(0,n.vs)('<div class="text-xs text-text-tertiary">loading subvolumes...'),tE=(0,n.vs)('<span class="cursor-pointer hover:text-text-secondary hover:underline">'),tR=(0,n.vs)('<tr class="hover:bg-bg-surface-raised text-xs"><td class="py-1 pr-2"><div class="flex items-center cursor-pointer"><span class="w-4 text-text-muted flex-shrink-0"></span><span class="font-mono text-text-default truncate"></span></div></td><td class="py-1 px-2 text-right font-mono text-text-tertiary"></td><td class="py-1 px-2 text-right font-mono text-text-muted"></td><td class="py-1 px-2"><div class="flex gap-1"></div></td><td class="py-1 px-2 font-mono text-text-muted text-[10px]"></td><td class="py-1 px-2 text-right text-text-muted">'),tz=(0,n.vs)('<tr><td colspan=6 class="py-2 px-2 text-xs text-text-tertiary text-center">No subvolumes found'),tF=(0,n.vs)('<div class="bg-bg-surface border border-border-default relative"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle flex justify-between items-center"><span class="text-xs text-text-tertiary">backups</span><span class="text-xs text-text-muted"> snapshots</span></div><div class=overflow-x-auto><div class="flex items-center border-b border-border-subtle bg-bg-surface-raised min-w-max"><div class="w-40 flex-shrink-0 px-2 py-1"></div><div class="flex gap-px mx-2 py-1"></div></div><div class="divide-y divide-border-subtle">'),tM=(0,n.vs)('<div class=space-y-2><div class="bg-bg-surface border border-border-default"><div class="px-2 py-1 bg-bg-surface-raised border-b border-border-subtle flex justify-between items-center"><span class="text-xs text-text-tertiary">subvolumes</span><span class="text-xs text-text-muted"></span></div><div class=overflow-x-auto><table class=w-full><thead><tr class="text-[10px] text-text-tertiary border-b border-border-subtle bg-bg-surface-raised"><th class="py-1 px-2 text-left font-medium">name</th><th class="py-1 px-2 text-right font-medium"title="Subvolume ID - unique numeric identifier">id</th><th class="py-1 px-2 text-right font-medium"title="Generation number - incremented on each modification">gen</th><th class="py-1 px-2 text-left font-medium"title="Subvolume flags and properties">props</th><th class="py-1 px-2 text-left font-medium"title="UUID - unique identifier (click to copy)">uuid</th><th class="py-1 px-2 text-right font-medium"title="Creation time">created</th></tr></thead><tbody class=font-mono>'),tB=(0,n.vs)('<div class="w-4 h-3 flex items-center justify-center text-[8px] text-text-muted flex-shrink-0">'),tL=(0,n.vs)(`<div class="flex items-center hover:bg-bg-surface-raised min-w-max"><div class="w-40 flex-shrink-0 px-2 py-2 text-xs truncate"><div class="font-medium text-text-default"></div><div class="text-text-muted text-[10px]"> \xb7 latest </div></div><div class="flex gap-px mx-2 py-1">`),t_=(0,n.vs)("<div>"),tT=(0,n.vs)("<div class=text-text-tertiary>+<!> more"),tA=(0,n.vs)('<div class="fixed z-50 bg-bg-overlay text-text-inverse text-xs rounded px-2 py-1.5 pointer-events-none shadow-lg max-w-xs"><div class="font-medium mb-1">: <!> backup</div><div class="space-y-0.5 max-h-24 overflow-y-auto">'),tI=(0,n.vs)('<div class="flex justify-between gap-3 text-text-faint"><span></span><span class=text-text-muted>');async function tZ(t){return(await i.qy.listSubvolumes({mountPath:t})).subvolumes}function tV(t){let[e,{refetch:r}]=(0,s.Zg)(()=>t.fs.path,tZ);return(0,s.Rc)(()=>{let t=()=>r();window.addEventListener("fs-refresh",t),(0,s.Ki)(()=>window.removeEventListener("fs-refresh",t))}),(0,s.a0)(s.tY,{get fallback(){return t$()},get children(){return(0,s.a0)(s.wv,{get when(){return e()},keyed:!0,children:e=>(0,s.a0)(tD,{get fs(){return t.fs},subvolumes:e,get expandedNodes(){return t.expandedNodes},get setExpandedNodes(){return t.setExpandedNodes}})})}})}function tD(t){var e,r,a,i;let l=(0,s.To)(()=>t.subvolumes.filter(e=>!(0,d.OM)(e.path,t.fs.btrbkSnapshotDir))),[o,u]=(0,s.n5)(null),h=(0,s.To)(()=>{let t=new Map;for(let e of l()){let r=e.parentId??0n;t.has(r)||t.set(r,[]),t.get(r).push(e)}return t}),g=(e,r)=>{var a,i,l,o,u,x,p,b,v,f,m;let w=h().get(e.id)||[],y=w.length>0,S=t.expandedNodes.has(e.id),C=e.path.split("/").pop()||e.path||"/",Y=!!e.parentUuid;return[(u=(o=(l=(i=(a=tR()).firstChild).firstChild).firstChild).nextSibling,v=(b=(p=(x=i.nextSibling).nextSibling).nextSibling).firstChild,m=(f=b.nextSibling).nextSibling,l.$$click=()=>{var r;return y&&(r=e.id,void t.setExpandedNodes(t=>{let e=new Set(t);return e.has(r)?e.delete(r):e.add(r),e}))},(0,n.$h)(l,"padding-left",`${16*r}px`),(0,n.Yr)(o,y?S?"▼":"▶":""),(0,n.Yr)(u,C),(0,n.Yr)(x,()=>(0,d.ZV)(e.id)),(0,n.Yr)(p,()=>(0,d.ZV)(e.gen)),(0,n.Yr)(v,(0,s.a0)(c.lN,{get active(){return e.isReadonly},label:"ro",get tooltip(){return e.isReadonly?"Read-only: This subvolume cannot be modified. Snapshots are typically read-only.":"Read-write: This subvolume can be modified."},activeClass:"bg-warning-subtle text-warning-muted"}),null),(0,n.Yr)(v,(0,s.a0)(c.lN,{active:Y,label:"snap",get tooltip(){return Y?`Snapshot: Created from parent ${e.parentUuid}`:"Not a snapshot: This is an original subvolume, not created from another."},activeClass:"bg-primary-muted text-primary-hover"}),null),(0,n.Yr)(f,(0,s.a0)(s.wv,{get when(){return e.uuid},fallback:"-",get children(){var k=tE();return k.$$click=()=>(0,d.lW)(e.uuid,"UUID copied"),(0,n.Yr)(k,()=>(0,d.yk)(e.uuid)),(0,s.gb)(()=>(0,n.Bq)(k,"title",`${e.uuid}
Click to copy`)),k}})),(0,n.Yr)(m,()=>(t=>{if(!t||0n===t||t<0n)return"-";let e=new Date(1e3*Number(t));return 1990>e.getFullYear()?"-":e.toISOString().split("T")[0]})(e.createdAt)),(0,s.gb)(t=>{var r=e.path,s=`Subvolume ID: ${e.id}`,a=`Generation number: ${e.gen}
Incremented on each transaction that modifies this subvolume`;return r!==t.e&&(0,n.Bq)(u,"title",t.e=r),s!==t.t&&(0,n.Bq)(x,"title",t.t=s),a!==t.a&&(0,n.Bq)(p,"title",t.a=a),t},{e:void 0,t:void 0,a:void 0}),a),(0,s.a0)(s.wv,{when:S,get children(){return(0,s.a0)(s.a,{each:w,children:t=>g(t,r+1)})}})]},x=(0,s.To)(()=>h().get(0n)||h().get(5n)||[]),p=(0,s.To)(()=>{if(!t.fs.btrbkSnapshotDir)return[];let e=new Map;for(let r of t.subvolumes){let n;if(!(0,d.OM)(r.path,t.fs.btrbkSnapshotDir))continue;let s=r.path.split("/").pop()||"",a=s.lastIndexOf(".");if(-1===a)continue;let i=s.substring(0,a),l=s.substring(a+1);if(l.length>=15&&"T"===l[8])n=new Date(parseInt(l.substring(0,4)),parseInt(l.substring(4,6))-1,parseInt(l.substring(6,8)),parseInt(l.substring(9,11)),parseInt(l.substring(11,13)),parseInt(l.substring(13,15)));else{if(!(l.length>=8))continue;n=new Date(parseInt(l.substring(0,4)),parseInt(l.substring(4,6))-1,parseInt(l.substring(6,8)))}e.has(i)||e.set(i,[]),e.get(i).push({date:n,path:r.path,name:s})}for(let t of e.values())t.sort((t,e)=>e.date.getTime()-t.date.getTime());return Array.from(e.entries()).sort((t,e)=>t[0].localeCompare(e[0]))}),b=(0,s.To)(()=>{let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),r=[],n=e+864e5;for(let t=0;t<14;t++){let e=n,s=e-864e5;n=s;let a=0===t?"today":`${t}d`;r.push({label:a,start:s,end:e})}for(let t=0;t<6;t++){let e=n,s=e-6048e5;n=s,r.push({label:`${t+2}w`,start:s,end:e})}for(let t=0;t<8;t++){let e=n,s=e-2592e6;n=s,r.push({label:`${t+2}mo`,start:s,end:e})}for(let t=0;t<4;t++){let e=n,s=e-7776e6;n=s,r.push({label:`${10+3*t}mo`,start:s,end:e})}for(let t=0;t<3;t++){let e=n,s=e-31536e6;n=s,r.push({label:`${t+2}y`,start:s,end:e})}return r}),v=(0,s.To)(()=>p().reduce((t,e)=>{let[,r]=e;return t+r.length},0)),f=()=>{u(null)};return a=(r=(e=tM()).firstChild.firstChild).firstChild.nextSibling,i=r.nextSibling.firstChild.firstChild.nextSibling,(0,n.Yr)(a,()=>(0,d.ZV)(l().length)),(0,n.Yr)(i,(0,s.a0)(s.a,{get each(){return x()},children:t=>g(t,0)}),null),(0,n.Yr)(i,(0,s.a0)(s.wv,{get when(){return 0===x().length},get children(){return tz()}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.fs.btrbkSnapshotDir)()&&p().length>0},get children(){var m=tF(),w=m.firstChild,y=w.firstChild.nextSibling,S=y.firstChild,C=w.nextSibling.firstChild,Y=C.firstChild.nextSibling,k=C.nextSibling;return(0,n.Yr)(y,v,S),(0,n.Yr)(Y,(0,s.a0)(s.a,{get each(){return b()},children:t=>{var e,r;return e=tB(),(0,n.Yr)(e,(r=(0,n.ph)(()=>t.label.length<=3),()=>r()?t.label:"")),(0,s.gb)(()=>(0,n.Bq)(e,"title",t.label)),e}})),(0,n.Yr)(k,(0,s.a0)(s.a,{get each(){return p()},children:t=>{var e,r,a,i,l,o;let[c,h]=t,g=h[0],x=(0,d.Fx)(g.date),p=b().map(t=>({...t,backups:h.filter(e=>{let r=e.date.getTime();return r>=t.start&&r<t.end})}));return l=(i=(a=(r=(e=tL()).firstChild).firstChild).nextSibling).firstChild,o=r.nextSibling,(0,n.Bq)(r,"title",c),(0,n.Yr)(a,c),(0,n.Yr)(i,()=>(0,d.ZV)(h.length),l),(0,n.Yr)(i,x,null),(0,n.Yr)(o,(0,s.a0)(s.a,{each:p,children:t=>{var e;let r=t.backups.length>0,s=t.backups.length;return(e=t_()).addEventListener("mouseleave",f),e.addEventListener("mouseenter",e=>((t,e)=>{if(0===e.backups.length)return;let r=t.target.getBoundingClientRect();u({x:r.left+r.width/2,y:r.top-8,slot:e})})(e,t)),(0,n.s7)(e,`w-4 h-4 rounded-sm flex-shrink-0 transition-colors ${r?s>1?"bg-primary hover:bg-primary-strong cursor-pointer":"bg-primary-softer hover:bg-primary cursor-pointer":"bg-bg-base"}`),e}})),e}})),(0,n.Yr)(m,(0,s.a0)(s.wv,{get when(){return o()},children:t=>{var e,r,a,i,l;let o=t().y<150;return(i=(a=(r=(e=tA()).firstChild).firstChild).nextSibling).nextSibling,l=r.nextSibling,(0,n.$h)(e,"transform",o?"translateX(-50%)":"translate(-50%, -100%)"),(0,n.Yr)(r,()=>t().slot.label,a),(0,n.Yr)(r,()=>(0,d.ZV)(t().slot.backups.length),i),(0,n.Yr)(r,()=>1!==t().slot.backups.length?"s":"",null),(0,n.Yr)(l,(0,s.a0)(s.a,{get each(){return t().slot.backups.slice(0,10)},children:t=>{var e,r,s;return s=(r=(e=tI()).firstChild).nextSibling,(0,n.Yr)(r,()=>t.date.toLocaleDateString()),(0,n.Yr)(s,()=>(0,d.Fx)(t.date)),e}}),null),(0,n.Yr)(l,(0,s.a0)(s.wv,{get when(){return t().slot.backups.length>10},get children(){var c=tT(),u=c.firstChild.nextSibling;return u.nextSibling,(0,n.Yr)(c,()=>(0,d.ZV)(t().slot.backups.length-10),u),c}}),null),(0,s.gb)(r=>{var s=`${t().x}px`,a=o?`${t().y+30}px`:`${t().y}px`;return s!==r.e&&(0,n.$h)(e,"left",r.e=s),a!==r.t&&(0,n.$h)(e,"top",r.t=a),r},{e:void 0,t:void 0}),e}}),null),m}}),null),e}(0,n.z_)(["click"]);var tN=(0,n.vs)('<div class=space-y-4><p class="text-xs text-text-tertiary">Configure scrub options before starting.</p><div class=space-y-3><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-default">Read-only mode</span><span class="text-xs text-text-muted">(-r)</span></label><p class="text-xs text-text-muted ml-6">Don\'t try to repair anything, just verify checksums.</p><div class=space-y-1><label class="text-sm text-text-default">Rate limit <span class="text-xs text-text-muted">(--limit)</span></label><div class="flex items-center space-x-2"><input type=number min=0 step=1 placeholder=0 class="w-24 px-2 py-1 text-sm bg-bg-default border border-border-default rounded focus:outline-none focus:border-primary"><span class="text-sm text-text-muted">MB/s (0 = unlimited)</span></div><p class="text-xs text-text-muted">Limit I/O per second to reduce system load.</p></div><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-default">Force</span><span class="text-xs text-text-muted">(-f)</span></label><p class="text-xs text-text-muted ml-6">Force starting even if a scrub is already running (only use if previous scrub crashed).</p></div><div class="flex justify-end space-x-2 pt-2 border-t border-border-subtle">');function tj(t){let[e,r]=(0,s.n5)(t.initialReadonly??!1),[a,i]=(0,s.n5)(""),[l,o]=(0,s.n5)(!1);(0,s.EH)(()=>{t.open&&r(t.initialReadonly??!1)});let d=()=>{let r=parseFloat(a())||0;t.onConfirm({readonly:e(),limitBytesPerSec:BigInt(Math.floor(1024*r*1024)),force:l()}),i(""),o(!1)},u=()=>{i(""),o(!1),t.onClose()};return(0,s.a0)(c.aF,{get open(){return t.open},onClose:u,title:"Start Scrub",get children(){var h=tN(),g=h.firstChild.nextSibling,x=g.firstChild,p=x.firstChild,b=x.nextSibling.nextSibling,v=b.firstChild.nextSibling.firstChild,f=b.nextSibling.firstChild,m=g.nextSibling;return p.addEventListener("change",t=>r(t.currentTarget.checked)),v.$$input=t=>i(t.currentTarget.value),f.addEventListener("change",t=>o(t.currentTarget.checked)),(0,n.Yr)(m,(0,s.a0)(c.$n,{variant:"soft",onClick:u,children:"Cancel"}),null),(0,n.Yr)(m,(0,s.a0)(c.$n,{variant:"primary",onClick:d,children:"Start Scrub"}),null),(0,s.gb)(()=>p.checked=e()),(0,s.gb)(()=>v.value=a()),(0,s.gb)(()=>f.checked=l()),h}})}(0,n.z_)(["input"]);var tO=(0,n.vs)('<div class=space-y-4><p class="text-xs text-text-tertiary">Balance redistributes data across devices to optimize space usage. This can take a long time depending on filesystem size.</p><div class=space-y-3><div class=space-y-2><span class="text-sm text-text-default">Balance types</span><div class="flex space-x-4"><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-secondary">Data</span></label><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-secondary">Metadata</span></label><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-secondary">System</span></label></div></div><div class=space-y-1><label class="text-sm text-text-default">Usage filter <span class="text-xs text-text-muted">(-dusage, -musage)</span></label><div class="flex items-center space-x-2"><input type=number min=0 max=100 step=1 placeholder=0 class="w-20 px-2 py-1 text-sm bg-bg-default border border-border-default rounded focus:outline-none focus:border-primary"><span class="text-sm text-text-muted">% (0 = all chunks)</span></div><p class="text-xs text-text-muted">Only balance chunks with usage at or below this percentage. 50% is a safe default that targets half-empty chunks.</p></div><div class=space-y-1><label class="text-sm text-text-default">Chunk limit <span class="text-xs text-text-muted">(-dlimit, -mlimit)</span></label><div class="flex items-center space-x-2"><input type=number min=0 step=1 placeholder=0 class="w-24 px-2 py-1 text-sm bg-bg-default border border-border-default rounded focus:outline-none focus:border-primary"><span class="text-sm text-text-muted">chunks (0 = no limit)</span></div><p class="text-xs text-text-muted">Limit total number of chunks to process. Useful for incremental balancing.</p></div><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-default">Dry run</span></label><p class="text-xs text-text-muted ml-6">Show what would be done without actually moving data.</p><label class="flex items-center space-x-2 cursor-pointer"><input type=checkbox class="w-4 h-4 accent-primary"><span class="text-sm text-text-default">Force</span><span class="text-xs text-text-muted">(-f)</span></label><p class="text-xs text-text-muted ml-6">Force starting even if a balance is already running.</p></div><div class="flex justify-end space-x-2 pt-2 border-t border-border-subtle">');function tq(t){let[e,r]=(0,s.n5)(!0),[a,i]=(0,s.n5)(!0),[l,o]=(0,s.n5)(!1),[d,u]=(0,s.n5)("50"),[h,g]=(0,s.n5)(""),[x,p]=(0,s.n5)(!1),[b,v]=(0,s.n5)(!1),f=()=>{let r=parseInt(d())||0,n=parseInt(h())||0;t.onConfirm({filters:{$typeName:"api.v1.BalanceFilters",data:e(),metadata:a(),system:l(),usagePercent:r,limitChunks:BigInt(n)},limitPercent:0,background:!1,dryRun:x(),force:b()}),m()},m=()=>{r(!0),i(!0),o(!1),u("50"),g(""),p(!1),v(!1)},w=()=>{m(),t.onClose()};return(0,s.a0)(c.aF,{get open(){return t.open},onClose:w,title:"Start Balance",get children(){var y=tO(),S=y.firstChild.nextSibling,C=S.firstChild,Y=C.firstChild.nextSibling.firstChild,k=Y.firstChild,P=Y.nextSibling,$=P.firstChild,E=P.nextSibling.firstChild,R=C.nextSibling,z=R.firstChild.nextSibling.firstChild,F=R.nextSibling,M=F.firstChild.nextSibling.firstChild,B=F.nextSibling,L=B.firstChild,_=B.nextSibling.nextSibling.firstChild,T=S.nextSibling;return k.addEventListener("change",t=>r(t.currentTarget.checked)),$.addEventListener("change",t=>i(t.currentTarget.checked)),E.addEventListener("change",t=>o(t.currentTarget.checked)),z.$$input=t=>u(t.currentTarget.value),M.$$input=t=>g(t.currentTarget.value),L.addEventListener("change",t=>p(t.currentTarget.checked)),_.addEventListener("change",t=>v(t.currentTarget.checked)),(0,n.Yr)(T,(0,s.a0)(c.$n,{variant:"soft",onClick:w,children:"Cancel"}),null),(0,n.Yr)(T,(0,s.a0)(c.$n,{variant:"primary",onClick:f,children:"Start Balance"}),null),(0,s.gb)(()=>k.checked=e()),(0,s.gb)(()=>$.checked=a()),(0,s.gb)(()=>E.checked=l()),(0,s.gb)(()=>z.value=d()),(0,s.gb)(()=>M.value=h()),(0,s.gb)(()=>L.checked=x()),(0,s.gb)(()=>_.checked=b()),y}})}(0,n.z_)(["input"]);var tU=(0,n.vs)("<div class=space-y-4>"),tX=(0,n.vs)("<svg width=14 height=14 class=inline-block style=transform:rotate(-90deg)><circle cx=7 cy=7 r=5 fill=none stroke=currentColor stroke-width=2 class=text-border-default></circle><circle cx=7 cy=7 r=5 fill=none stroke=currentColor stroke-width=2 class=text-primary>"),tH=(0,n.vs)('<span class="flex items-center gap-1 text-[10px] text-text-muted">'),tK=(0,n.vs)('<section><div class="flex items-center justify-between mb-2"><div class="flex items-center gap-2"><h3 class="text-xs font-medium text-text-secondary">scrub</h3></div><div class="flex space-x-1">'),tG=(0,n.vs)('<div class="text-xs text-text-tertiary">loading scrub status...'),tW=(0,n.vs)("<span>"),tJ=(0,n.vs)('<table class="w-full text-xs"><tbody>'),tQ=(0,n.vs)(`<span class=text-text-muted> → `),t0=(0,n.vs)('<span class="text-text-muted ml-2">(<!>)'),t1=(0,n.vs)('<span class="text-text-muted mx-1">/'),t2=(0,n.vs)("<span class=font-mono>"),t5=(0,n.vs)('<span class=font-mono><span class="text-text-muted ml-2">(</span><span></span><span class="text-text-muted ml-0.5">extents)'),t3=(0,n.vs)("<span class=text-success>none"),t4=(0,n.vs)('<span class=font-mono><span class=text-text-tertiary>no_csum:</span><span></span><span class="text-text-tertiary ml-3">discards:</span><span>'),t6=(0,n.vs)('<div class="flex flex-wrap gap-x-3 gap-y-1">'),t8=(0,n.vs)('<section><div class="flex items-center justify-between mb-2"><div class="flex items-center gap-2"><h3 class="text-xs font-medium text-text-secondary">balance</h3></div><div class="flex space-x-1">'),t7=(0,n.vs)('<div class="text-xs text-text-tertiary">loading balance status...'),t9=(0,n.vs)('<span class="text-text-muted ml-2">(<!> left)'),et=(0,n.vs)('<span class=font-mono><span></span><span class="text-text-muted mx-1">/</span><span></span><span class="text-text-muted ml-1">chunks'),ee=(0,n.vs)("<span class=font-mono> chunks");function er(t){var e;let[r,{refetch:a}]=(0,s.Zg)(()=>t.fs.path,t=>i.ZV.getScrubStatus({devicePath:t})),[l,{refetch:o}]=(0,s.Zg)(()=>t.fs.path,t=>i.aE.getBalanceStatus({devicePath:t}));(0,s.Rc)(()=>{let t=()=>{a(),o()};window.addEventListener("fs-refresh",t),(0,s.Ki)(()=>window.removeEventListener("fs-refresh",t))});let[d,c]=(0,s.n5)(null),[u,h]=(0,s.n5)(2),[g,x]=(0,s.n5)(0),p=()=>{var t;return(null==(t=r.latest)?void 0:t.isRunning)??!1},b=()=>{var t;return(null==(t=l.latest)?void 0:t.isRunning)??!1},v=!1;(0,s.EH)(()=>{let t=r(),e=l();!v&&t&&e&&(v=!0,(t.isRunning||e.isRunning)&&f())});let f=()=>{if(d())return;a(),o(),h(2),x(5);let t=setInterval(()=>{h(e=>{if(e<=1){let e=p()||b(),r=g();return e||r>0?(a(),o(),e||x(r-1)):(clearInterval(t),c(null)),2}return e-1})},1e3);c(t)};(0,s.Ki)(()=>{let t;(t=d())&&(clearInterval(t),c(null))});let m=async e=>{try{await i.ZV.startScrub({devicePath:t.fs.path,readonly:e.readonly,limitBytesPerSec:e.limitBytesPerSec,force:e.force}),f()}catch(e){t.setError(String(e))}},w=async()=>{try{await i.ZV.cancelScrub({devicePath:t.fs.path}),a()}catch(e){t.setError(String(e))}},y=async e=>{try{await i.aE.startBalance({devicePath:t.fs.path,filters:e.filters,limitPercent:e.limitPercent,background:e.background,dryRun:e.dryRun,force:e.force}),f()}catch(e){t.setError(String(e))}},S=async()=>{try{await i.aE.cancelBalance({devicePath:t.fs.path}),o()}catch(e){t.setError(String(e))}};return e=tU(),(0,n.Yr)(e,(0,s.a0)(es,{scrubData:r,get scrubRunning(){return p()},onStart:m,onCancel:w,get isPolling(){return null!==d()},get pollingCountdown(){return u()}}),null),(0,n.Yr)(e,(0,s.a0)(ei,{balanceData:l,get balanceRunning(){return b()},onStart:y,onCancel:S,get isPolling(){return null!==d()},get pollingCountdown(){return u()}}),null),e}function en(t){var e,r;let a=2*Math.PI*5;return r=(e=tX()).firstChild.nextSibling,(0,n.Bq)(r,"stroke-dasharray",a),(0,s.gb)(()=>(0,n.Bq)(r,"stroke-dashoffset",a-t.countdown/t.total*a)),e}function es(t){var e,r,a;let[i,l]=(0,s.n5)(!1),[d,u]=(0,s.n5)(!1),h=()=>{var e;return null==(e=t.scrubData.latest)?void 0:e.progress},g=(0,s.To)(()=>{let t=h();return!!t&&(t.readErrors>0||t.csumErrors>0||t.verifyErrors>0||t.superErrors>0||t.mallocErrors>0||t.unverifiedErrors>0||t.dataErrors>0||t.treeErrors>0||t.uncorrectableErrors>0)}),x=(0,s.To)(()=>{let e=h();return e?t.scrubRunning?{class:"text-primary",text:`running ${e.progressPercent.toFixed(1)}%`}:"finished"===e.status?g()?{class:"text-error",text:"finished with errors"}:{class:"text-success",text:"ok"}:"aborted"===e.status||"canceled"===e.status?{class:"text-warning",text:e.status}:{class:"text-text-tertiary",text:e.status||"unknown"}:{class:"text-text-muted",text:"never run"}});return(r=(e=tK()).firstChild.firstChild).firstChild,a=r.nextSibling,(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.isPolling)()&&t.scrubRunning},get children(){var p=tH();return(0,n.Yr)(p,(0,s.a0)(en,{get countdown(){return t.pollingCountdown},total:2})),p}}),null),(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return t.scrubRunning},get children(){return(0,s.a0)(c.$n,{variant:"danger",get onClick(){return t.onCancel},children:"cancel"})}}),null),(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return!t.scrubRunning},get children(){return[(0,s.a0)(c.$n,{variant:"primary",onClick:()=>{u(!1),l(!0)},children:"scrub"}),(0,s.a0)(c.$n,{variant:"soft",title:"read-only (no repair)",onClick:()=>{u(!0),l(!0)},children:"r/o"})]}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.scrubRunning)()&&h()},get children(){return(0,s.a0)(c.z2,{get value(){return h().progressPercent},size:"sm",colorClass:"bg-primary",class:"mb-2"})}}),null),(0,n.Yr)(e,(0,s.a0)(s.tY,{get fallback(){return tG()},get children(){return(0,s.a0)(s.wv,{get when(){return t.scrubData.latest},get children(){return(0,s.a0)(ea,{get scrubStatus(){return h()},get scrubRunning(){return t.scrubRunning},get showRawBytes(){return(0,o.mH)().showRawBytes},get statusBadge(){return x()},get hasErrors(){return g()}})}})}}),null),(0,n.Yr)(e,(0,s.a0)(tj,{get open(){return i()},onClose:()=>l(!1),onConfirm:e=>{l(!1),t.onStart(e)},get initialReadonly(){return d()}}),null),e}function ea(t){var e,r;return r=(e=tJ()).firstChild,(0,n.Yr)(r,(0,s.a0)(c.jP,{label:"status",get children(){var a=tW();return(0,n.Yr)(a,()=>t.statusBadge.text),(0,s.gb)(()=>(0,n.s7)(a,t.statusBadge.class)),a}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return t.scrubStatus},children:e=>[(0,s.a0)(c.jP,{label:"time",get children(){return(0,s.a0)(s.wv,{get when(){return e().startedAt>0n},fallback:"-",get children(){var r;return[(r=tW(),(0,n.Yr)(r,()=>new Date(1e3*Number(e().startedAt)).toLocaleString("sv-SE",{dateStyle:"short",timeStyle:"short"})),r),(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>e().finishedAt>0n)()&&!t.scrubRunning},get children(){var a=tQ();return a.firstChild,(0,n.Yr)(a,()=>new Date(1e3*Number(e().finishedAt)).toLocaleTimeString("sv-SE",{timeStyle:"short"}),null),a}}),(0,s.a0)(s.wv,{get when(){return e().duration},get children(){var i=t0(),l=i.firstChild.nextSibling;return l.nextSibling,(0,n.Yr)(i,()=>e().duration,l),i}})]}})}}),(0,s.a0)(c.jP,{label:"scrubbed",get children(){var o=t2();return(0,n.Yr)(o,(0,s.a0)(c.OV,{get bytes(){return e().bytesScrubbed},get showRaw(){return t.showRawBytes}}),null),(0,n.Yr)(o,(0,s.a0)(s.wv,{get when(){return e().totalBytes>0n},get children(){return[t1(),(0,s.a0)(c.OV,{get bytes(){return e().totalBytes},get showRaw(){return t.showRawBytes}})]}}),null),o}}),(0,s.a0)(c.jP,{label:"data",get children(){var u=t5(),h=u.firstChild,g=h.nextSibling;return(0,n.Yr)(u,(0,s.a0)(c.OV,{get bytes(){return e().dataBytesScrubbed},get showRaw(){return t.showRawBytes}}),h),(0,n.Yr)(g,()=>(0,d.ZV)(e().dataExtentsScrubbed)),u}}),(0,s.a0)(c.jP,{label:"tree",get children(){var x=t5(),p=x.firstChild,b=p.nextSibling;return(0,n.Yr)(x,(0,s.a0)(c.OV,{get bytes(){return e().treeBytesScrubbed},get showRaw(){return t.showRawBytes}}),p),(0,n.Yr)(b,()=>(0,d.ZV)(e().treeExtentsScrubbed)),x}}),(0,s.a0)(c.jP,{label:"errors",get children(){return(0,s.a0)(s.wv,{get when(){return!t.hasErrors},get fallback(){var v;return v=t6(),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"data",get count(){return e().dataErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"tree",get count(){return e().treeErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"read",get count(){return e().readErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"csum",get count(){return e().csumErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"verify",get count(){return e().verifyErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"super",get count(){return e().superErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"malloc",get count(){return e().mallocErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"unverified",get count(){return e().unverifiedErrors}}),null),(0,n.Yr)(v,(0,s.a0)(c.PX,{label:"uncorrectable",get count(){return e().uncorrectableErrors},critical:!0}),null),(0,n.Yr)(v,(0,s.a0)(c.nl,{label:"corrected",get count(){return e().correctedErrors}}),null),v},get children(){return t3()}})}}),(0,s.a0)(c.jP,{label:"csum",get children(){var f=t4(),m=f.firstChild.nextSibling,w=m.nextSibling.nextSibling;return(0,n.Yr)(m,()=>(0,d.ZV)(e().noCsum)),(0,n.Yr)(w,()=>(0,d.ZV)(e().csumDiscards)),f}}),(0,s.a0)(s.wv,{get when(){return e().lastPhysical>0n},get children(){return(0,s.a0)(c.jP,{label:"position",get children(){var y=t2();return(0,n.Yr)(y,(0,s.a0)(c.OV,{get bytes(){return e().lastPhysical},get showRaw(){return t.showRawBytes}})),y}})}})]}),null),e}function ei(t){var e,r,a;let[i,l]=(0,s.n5)(!1),d=()=>{var e;return null==(e=t.balanceData.latest)?void 0:e.progress},u=(0,s.To)(()=>{let e=d();if(!e||"idle"===e.status||"never_run"===e.status)return{class:"text-text-muted",text:"idle"};if(t.balanceRunning){var r;let t=(null==(r=e.progressPercent)?void 0:r.toFixed(1))||"0";return{class:"text-primary",text:`running ${t}%`}}return"paused"===e.status?{class:"text-warning",text:"paused"}:"finished"===e.status?{class:"text-success",text:"finished"}:"cancelled"===e.status?{class:"text-warning",text:"cancelled"}:{class:"text-text-tertiary",text:e.status||"unknown"}});return(r=(e=t8()).firstChild.firstChild).firstChild,a=r.nextSibling,(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.isPolling)()&&t.balanceRunning},get children(){var h=tH();return(0,n.Yr)(h,(0,s.a0)(en,{get countdown(){return t.pollingCountdown},total:2})),h}}),null),(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return t.balanceRunning},get children(){return(0,s.a0)(c.$n,{variant:"danger",get onClick(){return t.onCancel},children:"cancel"})}}),null),(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return!t.balanceRunning},get children(){return(0,s.a0)(c.$n,{variant:"primary",onClick:()=>l(!0),children:"balance"})}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.balanceRunning)()&&d()},get children(){return(0,s.a0)(c.z2,{get value(){return d().progressPercent},size:"sm",colorClass:"bg-primary",class:"mb-2"})}}),null),(0,n.Yr)(e,(0,s.a0)(s.tY,{get fallback(){return t7()},get children(){return(0,s.a0)(s.wv,{get when(){return t.balanceData.latest},get children(){return(0,s.a0)(el,{get balanceStatus(){return d()},get balanceRunning(){return t.balanceRunning},get showRawBytes(){return(0,o.mH)().showRawBytes},get statusBadge(){return u()}})}})}}),null),(0,n.Yr)(e,(0,s.a0)(tq,{get open(){return i()},onClose:()=>l(!1),onConfirm:e=>{l(!1),t.onStart(e)}}),null),e}function el(t){var e,r;return r=(e=tJ()).firstChild,(0,n.Yr)(r,(0,s.a0)(c.jP,{label:"status",get children(){var a=tW();return(0,n.Yr)(a,()=>t.statusBadge.text),(0,s.gb)(()=>(0,n.s7)(a,t.statusBadge.class)),a}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!t.balanceStatus)()&&"idle"!==t.balanceStatus.status},children:e=>[(0,s.a0)(s.wv,{get when(){return e().totalChunks>0n},get children(){return(0,s.a0)(c.jP,{label:"progress",get children(){var r=et(),a=r.firstChild,i=a.nextSibling.nextSibling;return i.nextSibling,(0,n.Yr)(a,()=>(0,d.ZV)(e().relocated)),(0,n.Yr)(i,()=>(0,d.ZV)(e().totalChunks)),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return e().left>0n},get children(){var l=t9(),o=l.firstChild.nextSibling;return o.nextSibling,(0,n.Yr)(l,()=>(0,d.ZV)(e().left),o),l}}),null),r}})}}),(0,s.a0)(s.wv,{get when(){return e().considered>0n},get children(){return(0,s.a0)(c.jP,{label:"considered",get children(){var u=ee(),h=u.firstChild;return(0,n.Yr)(u,()=>(0,d.ZV)(e().considered),h),u}})}}),(0,s.a0)(s.wv,{get when(){return e().sizeRelocated>0n},get children(){return(0,s.a0)(c.jP,{label:"relocated",get children(){var g=t2();return(0,n.Yr)(g,(0,s.a0)(c.OV,{get bytes(){return e().sizeRelocated},get showRaw(){return t.showRawBytes}})),g}})}}),(0,s.a0)(s.wv,{get when(){return e().softErrors>0},get children(){return(0,s.a0)(c.jP,{label:"errors",get children(){return(0,s.a0)(c.nl,{label:"soft",get count(){return e().softErrors}})}})}}),(0,s.a0)(s.wv,{get when(){return e().duration},get children(){return(0,s.a0)(c.jP,{label:"duration",get children(){var x=t2();return(0,n.Yr)(x,()=>e().duration),x}})}})]}),null),e}var eo=(0,n.vs)('<div class="flex items-center space-x-3 text-xs">'),ed=(0,n.vs)('<div class="absolute top-0 right-0 text-xs text-text-muted">refreshing...'),ec=(0,n.vs)('<div class="space-y-4 relative">'),eu=(0,n.vs)('<div class=space-y-3><div class="flex items-center justify-between"><div class="flex items-center space-x-2"><div class=flex><button>layout</button><button>density'),eh=(0,n.vs)("<button><span>"),eg=(0,n.vs)('<div class="flex items-center space-x-4 text-xs"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-1"><span class=text-text-muted>0%</span><span class=text-text-muted>100%'),ex=(0,n.vs)('<span class="flex items-center"><span class="w-3 h-3 mr-1">'),ep=(0,n.vs)('<div class="w-16 h-3 rounded-sm">'),eb=(0,n.vs)('<div class="h-32 flex items-center justify-center text-text-muted text-xs">loading...'),ev=(0,n.vs)('<div><div class="flex items-center justify-between mb-2"><span class="text-xs font-medium"> device<span class="text-text-muted ml-2">(<!> total)</span></span><span class="text-xs text-text-secondary">% allocated<span class="text-text-muted ml-2"> extents'),ef=(0,n.vs)('<div><div class="flex items-center justify-between mb-2"><span class="text-xs font-medium"> device<span class="text-text-muted ml-2">(<!> total)</span></span><span class="text-xs text-text-secondary">% used<span class="text-text-muted ml-2"> extents'),em=(0,n.vs)('<div class="absolute inset-0 flex items-center justify-center bg-bg-surface/80 z-10"><span class="text-xs text-text-muted">Drawing...'),ew=(0,n.vs)('<div class=w-full><div class="mb-1 text-xs text-text-secondary h-4 flex items-center"></div><div class=relative><canvas class=cursor-pointer style=image-rendering:pixelated>'),ey=(0,n.vs)('<span class="text-text-muted mr-2">[locked]'),eS=(0,n.vs)("<span class=font-medium>"),eC=(0,n.vs)("<span class=mx-2>|"),eY=(0,n.vs)("<span class=font-mono>"),ek=(0,n.vs)("<span>size: "),eP=(0,n.vs)("<span>"),e$=(0,n.vs)("<span>chunk: <!> / "),eE=(0,n.vs)("<span>unallocated"),eR=(0,n.vs)("<span class=ml-1>(<!>% used)"),ez=(0,n.vs)('<svg class="absolute top-0 left-0 pointer-events-none"style=overflow:visible><path fill=none stroke-width=2>');let eF=t=>{let e=[[180,.6,.42],[220,.65,.45],[270,.6,.45],[320,.65,.45],[0,.65,.45],[30,.65,.45],[60,.65,.45],[120,.6,.4]];return new m({anchorColors:e,numPoints:Math.max(Math.ceil(t/(e.length-1)),2),positionFunction:b}).colors.slice(0,t).map(t=>{let e,r,n,s,a,i,[l,o,d]=t,c=Math.max(.38,Math.min(.48,d));return r=(e=(1-Math.abs(2*c-1))*o)*(1-Math.abs(l/60%2-1)),n=c-e/2,s=0,a=0,i=0,l<60?(s=e,a=r):l<120?(s=r,a=e):l<180?(a=e,i=r):l<240?(a=r,i=e):l<300?(s=r,i=e):(s=e,i=r),[Math.round((s+n)*255),Math.round((a+n)*255),Math.round((i+n)*255)]})},eM={data:{bg:"bg-viz-data",hex:"var(--color-viz-data)",isFree:!1,rgb:[59,130,246]},metadata:{bg:"bg-viz-metadata",hex:"var(--color-viz-metadata)",isFree:!1,rgb:[168,85,247]},system:{bg:"bg-viz-system",hex:"var(--color-viz-system)",isFree:!1,rgb:[249,115,22]},free:{bg:"bg-viz-free",hex:"var(--color-viz-free)",isFree:!0,rgb:[229,231,235]}};function eB(t){var e,r,a,l;let[c,u]=(0,s.n5)("blockmap"),[h,g]=(0,s.n5)(null),[x]=(0,s.Zg)(()=>t.fsPath,async t=>(await i.cI.getDeviceBlockMaps({fsPath:t,deviceIds:[]})).maps.map(t=>({device:t.device,entries:t.entries,totalSize:t.totalSize,stats:t.stats||null}))),p=()=>{var t;return(null==(t=x())?void 0:t.map(t=>t.device))||[]};return(0,s.EH)(()=>{c(),g(null)}),l=(a=(r=(e=eu()).firstChild).firstChild.firstChild.firstChild).nextSibling,a.$$click=()=>u("blockmap"),l.$$click=()=>u("heatmap"),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return"blockmap"===c()},get children(){var b=eo();return(0,n.Yr)(b,(0,s.a0)(s.a,{each:["data","metadata","system","free"],children:t=>{var e,r;return r=(e=eh()).firstChild,e.$$click=()=>{let e;(null==(e=h())?void 0:e.type)===t?g({type:t,index:e.index+1}):g({type:t,index:0})},(0,n.Bq)(e,"title",`Click to cycle through ${t} extents`),(0,n.Yr)(e,t,null),(0,s.gb)(s=>{var a,i=`flex items-center cursor-pointer hover:underline ${(null==(a=h())?void 0:a.type)===t?"font-bold":""}`,l=`w-3 h-3 ${eM[t].bg} mr-1`;return i!==s.e&&(0,n.s7)(e,s.e=i),l!==s.t&&(0,n.s7)(r,s.t=l),s},{e:void 0,t:void 0}),e}})),b}}),null),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>"heatmap"===c())()&&p().length>0},get children(){var v,f,m,w;let t,e;return e=eF(Math.max((t=p()).length,2)),w=(m=(f=(v=eg()).firstChild).nextSibling).firstChild.nextSibling,(0,n.Yr)(f,(0,s.a0)(s.a,{each:t,children:(t,r)=>{var s,a;let[i,l,o]=e[r()%e.length],d=`rgb(${i}, ${l}, ${o})`,c=t.path?t.path.split("/").pop():`dev${t.id}`;return a=(s=ex()).firstChild,(0,n.$h)(a,"background-color",d),(0,n.Yr)(s,c,null),s}})),(0,n.Yr)(m,()=>{var t;let[r,s,a]=e[0];return t=ep(),(0,n.$h)(t,"background",`linear-gradient(to right, rgb(240, 245, 250), rgb(${r}, ${s}, ${a}))`),t},w),v}}),null),(0,n.Yr)(e,(0,s.a0)(s.tY,{get fallback(){return eb()},get children(){var y=ec();return(0,n.Yr)(y,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>!!x.loading)()&&x()},get children(){return ed()}}),null),(0,n.Yr)(y,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>"blockmap"===c())()&&x()},children:t=>{var e,r,a,i,l,c,u,g,x;let p=()=>t().reduce((t,e)=>t+Number(e.totalSize),0);return x=(g=(u=((l=(i=(a=(r=(e=ev()).firstChild.firstChild).firstChild).nextSibling).firstChild.nextSibling).nextSibling,c=r.nextSibling).firstChild).nextSibling).firstChild,(0,n.Yr)(r,()=>t().length,a),(0,n.Yr)(r,()=>1!==t().length?"s":"",i),(0,n.Yr)(i,()=>(0,d.z3)(BigInt(p()),(0,o.mH)().showRawBytes),l),(0,n.Yr)(c,()=>p()>0?(t().reduce((t,e)=>{var r;return t+Number((null==(r=e.stats)?void 0:r.allocatedSize)||0n)},0)/p()*100).toFixed(1):"0",u),(0,n.Yr)(g,()=>(0,d.ZV)(t().reduce((t,e)=>{var r;return t+((null==(r=e.stats)?void 0:r.numExtents)||0)},0)),x),(0,n.Yr)(e,(0,s.a0)(eL,{get maps(){return t()},get showRawBytes(){return(0,o.mH)().showRawBytes},colorMode:"type",get selectByType(){return h()}}),null),e}}),null),(0,n.Yr)(y,(0,s.a0)(s.wv,{get when(){return(0,n.ph)(()=>"heatmap"===c())()&&x()},children:t=>{var e,r,a,i,l,c,u,h,g;let x=()=>t().reduce((t,e)=>t+Number(e.totalSize),0);return g=(h=(u=((l=(i=(a=(r=(e=ef()).firstChild.firstChild).firstChild).nextSibling).firstChild.nextSibling).nextSibling,c=r.nextSibling).firstChild).nextSibling).firstChild,(0,n.Yr)(r,()=>t().length,a),(0,n.Yr)(r,()=>1!==t().length?"s":"",i),(0,n.Yr)(i,()=>(0,d.z3)(BigInt(x()),(0,o.mH)().showRawBytes),l),(0,n.Yr)(c,()=>x()>0?(t().reduce((t,e)=>{var r;return t+Number((null==(r=e.stats)?void 0:r.allocatedSize)||0n)},0)/x()*100).toFixed(1):"0",u),(0,n.Yr)(h,()=>(0,d.ZV)(t().reduce((t,e)=>{var r;return t+((null==(r=e.stats)?void 0:r.numExtents)||0)},0)),g),(0,n.Yr)(e,(0,s.a0)(eL,{get maps(){return t()},get showRawBytes(){return(0,o.mH)().showRawBytes},colorMode:"utilization"}),null),e}}),null),y}}),null),(0,s.gb)(t=>{var e=`px-2 py-1 text-xs cursor-pointer ${"blockmap"===c()?"bg-interactive text-text-inverse":"bg-bg-muted text-text-secondary"}`,r=`px-2 py-1 text-xs cursor-pointer ${"heatmap"===c()?"bg-interactive text-text-inverse":"bg-bg-muted text-text-secondary"}`;return e!==t.e&&(0,n.s7)(a,t.e=e),r!==t.t&&(0,n.s7)(l,t.t=r),t},{e:void 0,t:void 0}),e}function eL(t){var e,r,a,i,l,o;let c,u,[h,g]=(0,s.n5)(null),[x,p]=(0,s.n5)(null),[b,v]=(0,s.n5)(800),[f,m]=(0,s.n5)({width:800,height:200}),[w,y]=(0,s.n5)(!0),S=(0,s.To)(()=>{let t=x()||h();if(!t)return null;let e=b(),r=Math.ceil(e/1.618/12),n=Math.floor(t.pixelStart/e),s=Math.floor((t.pixelEnd-1)/e);if(n>s||n>=r)return null;let a=[];for(let i=n;i<=s&&i<r;i++){let r,n,s=i*e,l=(i+1)*e,o=Math.max(t.pixelStart,s),d=Math.min(t.pixelEnd,l),c=o-s,u=d-s;i%2==0?(r=c,n=u):(r=e-u,n=e-c),a.push({x:Math.min(r,n),y:12*i,w:Math.abs(n-r),h:12,row:i})}if(0===a.length)return null;if(1===a.length){let t=a[0];return`M ${t.x} ${t.y} h ${t.w} v ${t.h} h ${-t.w} Z`}let i=[],l=a[0];i.push(`M ${l.x} ${l.y}`),i.push(`h ${l.w}`);for(let t=0;t<a.length;t++){let e=a[t],r=a[t+1];if(r){let t=e.x+e.w,n=r.x+r.w;i.push(`v ${e.h}`),n!==t&&i.push(`h ${n-t}`)}else i.push(`v ${e.h}`)}let o=a[a.length-1];i.push(`h ${-o.w}`);for(let t=a.length-1;t>=0;t--){let e=a[t],r=a[t-1];if(r){let t=e.x,n=r.x;i.push(`v ${-e.h}`),n!==t&&i.push(`h ${n-t}`)}else i.push(`v ${-e.h}`)}return i.push("Z"),i.join(" ")}),C=(0,s.To)(()=>{let e=new Map;return t.maps.forEach((t,r)=>{e.set(t.device.id,r)}),e}),Y=(0,s.To)(()=>eF(Math.max(t.maps.length,2))),k=(0,s.To)(()=>{let e=0n;for(let r of t.maps)e+=r.totalSize;if(0n===e)return{extents:[],totalPixels:0,bytesPerPixel:1};let r=b(),n=Math.ceil(r/1.618/12),s=r*n,a=Number(e)/s,i=[],l=0;for(let e of t.maps){for(let t of e.entries){let r=l+Number(t.offset),n=r+Number(t.length);i.push({device:e.device,offset:t.offset,length:t.length,allocated:t.allocated,type:t.type,chunkUsed:t.chunkUsed,chunkLength:t.chunkLength,pixelStart:Math.floor(r/a),pixelEnd:Math.ceil(n/a)})}l+=Number(e.totalSize)}return{extents:i,totalPixels:s,bytesPerPixel:a}});(0,s.EH)(()=>{let e=t.selectByType;if(!e)return;let{extents:r}=k(),n=r.filter(t=>(function(t,e){if(!e)return"free";let r=Number(t);return 1&r?"data":4&r?"metadata":2&r?"system":"free"})(t.type,t.allocated)===e.type);if(0===n.length)return;let s=e.index%n.length,a=n[s];p(a),g(a)});let P=()=>{if(!c||!u)return;let e=c.getContext("2d");if(!e)return;let r=u.clientWidth;r!==b()?v(r):(y(!0),requestAnimationFrame(()=>{let n=Math.ceil(r/1.618/12),s=12*n;c.width=r,c.height=s,m({width:r,height:s});let{extents:a}=k(),i=Y(),l=C(),o=e.createImageData(r,s),d=new Uint32Array(o.data.buffer);for(let e of(d.fill(-986896),a)){let s,a,o;if("type"===t.colorMode){let t=e.allocated?function(t){let e=Number(t);return 1&e?eM.data:4&e?eM.metadata:2&e?eM.system:eM.free}(e.type):eM.free;[s,a,o]=t.rgb}else{let[t,r,n]=i[(l.get(e.device.id)??0)%i.length],d=0;if(e.allocated&&e.chunkLength>0n&&(d=Number(e.chunkUsed)/Number(e.chunkLength)),e.allocated){let e=Math.floor(t+(245-t)*.7),i=Math.floor(r+(245-r)*.7),l=Math.floor(n+(245-n)*.7);s=Math.floor(e+(t-e)*d),a=Math.floor(i+(r-i)*d),o=Math.floor(l+(n-l)*d)}else s=Math.floor(t+(250-t)*.85),a=Math.floor(r+(250-r)*.85),o=Math.floor(n+(250-n)*.85)}let c=-0x1000000|o<<16|a<<8|s,u=e.pixelStart,h=e.pixelEnd;for(let t=u;t<h;t++){let e=Math.floor(t/r),s=t%r,a=e%2==0?s:r-1-s;if(!(e>=n))for(let t=0;t<12;t++){let n=(12*e+t)*r+a;n<d.length&&(d[n]=c)}}}e.putImageData(o,0,0);let{bytesPerPixel:u}=k(),h=0;for(let s of(e.strokeStyle="type"===t.colorMode?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.9)",e.lineWidth=2,t.maps)){let t=h+Math.ceil(Number(s.totalSize)/u),a=Math.floor(t/r),i=t%r,l=a%2==0?i:r-1-i;a<n&&i>0&&(e.beginPath(),e.moveTo(l,12*a),e.lineTo(l,(a+1)*12),e.stroke()),h=t}y(!1)}))},$=t=>{c&&!c.contains(t.target)&&p(null)};(0,s.Rc)(()=>{u&&v(u.clientWidth),P(),u&&new ResizeObserver(t=>{for(let e of t){let t=e.contentRect.width;t>0&&t!==b()&&v(t)}}).observe(u),document.addEventListener("click",$),document.addEventListener("keydown",R)}),(0,s.Ki)(()=>{document.removeEventListener("click",$),document.removeEventListener("keydown",R)}),(0,s.EH)(()=>{k(),b(),P()});let E=t=>{let{extents:e}=k();for(let r of e)if(t>=r.pixelStart&&t<r.pixelEnd)return r;return null},R=t=>{let e,r=x();if(!r||"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.preventDefault();let{extents:n}=k(),s=n.findIndex(t=>t.device.id===r.device.id&&t.offset===r.offset);if(-1===s)return;e="ArrowLeft"===t.key?s>0?s-1:n.length-1:s<n.length-1?s+1:0;let a=n[e];p(a),g(a)};return i=(a=(r=(e=ew()).firstChild).nextSibling).firstChild,"function"==typeof(l=u)?(0,n.Yx)(l,e):u=e,(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return x()||h()},children:e=>{var r,a,i;return[(0,s.a0)(s.wv,{get when(){return x()},get children(){return ey()}}),(r=eS(),(0,n.Yr)(r,()=>e().device.path||`Device ${e().device.id}`),r),eC(),(a=eY(),(0,n.Yr)(a,()=>(0,d.z3)(e().offset,t.showRawBytes)),a),eC(),((i=ek()).firstChild,(0,n.Yr)(i,()=>(0,d.z3)(e().length,t.showRawBytes),null),i),eC(),(0,s.a0)(s.wv,{get when(){return"type"===t.colorMode},get fallback(){return(0,s.a0)(s.wv,{get when(){return e().allocated},get fallback(){return eE()},get children(){var l,o;return[((o=(l=e$()).firstChild.nextSibling).nextSibling,(0,n.Yr)(l,()=>(0,d.z3)(e().chunkUsed??0n,t.showRawBytes),o),(0,n.Yr)(l,()=>(0,d.z3)(e().chunkLength??0n,t.showRawBytes),null),l),(0,s.a0)(s.wv,{get when(){let t,r;return r=(t=e()).chunkLength??0n,t.allocated&&r>0n?(Number(t.chunkUsed??0n)/Number(r)*100).toFixed(1):null},children:t=>{var e,r;return(r=(e=eR()).firstChild.nextSibling).nextSibling,(0,n.Yr)(e,t,r),e}})]}})},get children(){var c=eP();return(0,n.Yr)(c,()=>((t,e)=>{if(!e)return"free";let r=Number(t);return 1&r?"data":4&r?"metadata":2&r?"system":"unknown"})(e().type,e().allocated)),c}})]}})),(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return w()},get children(){return em()}}),i),i.$$click=t=>{if(!c)return;let e=c.getBoundingClientRect(),r=Math.floor(t.clientX-e.left),n=Math.floor((t.clientY-e.top)/12),s=b(),a=E(n*s+(n%2==0?r:s-1-r));x()===a?p(null):(p(a),g(a))},i.addEventListener("mouseleave",()=>{x()||g(null)}),i.$$mousemove=t=>{if(x()||!c)return;let e=c.getBoundingClientRect(),r=Math.floor(t.clientX-e.left),n=Math.floor((t.clientY-e.top)/12),s=b();g(E(n*s+(n%2==0?r:s-1-r)))},"function"==typeof(o=c)?(0,n.Yx)(o,i):c=i,(0,n.Yr)(a,(0,s.a0)(s.wv,{get when(){return S()},children:e=>{var r,a;return a=(r=ez()).firstChild,(0,s.gb)(s=>{var i=f().width,l=f().height,o=e(),d=x()?"rgba(250, 204, 21, 0.9)":"type"===t.colorMode?"rgba(0, 0, 0, 0.7)":"rgba(255, 255, 255, 0.9)",c=x()?"drop-shadow(0 0 4px rgba(250, 204, 21, 0.7))":"type"===t.colorMode?"drop-shadow(0 0 2px rgba(255, 255, 255, 0.8))":"drop-shadow(0 0 3px rgba(0, 0, 0, 0.6))";return i!==s.e&&(0,n.Bq)(r,"width",s.e=i),l!==s.t&&(0,n.Bq)(r,"height",s.t=l),o!==s.a&&(0,n.Bq)(a,"d",s.a=o),d!==s.o&&(0,n.Bq)(a,"stroke",s.o=d),c!==s.i&&(0,n.Bq)(a,"filter",s.i=c),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),r}}),null),e}function e_(t){return(0,s.a0)(eB,{get fsPath(){return t.fsPath}})}(0,n.z_)(["click","mousemove"]);var eT=(0,n.vs)('<div class="text-xs text-text-tertiary">loading errors...'),eA=(0,n.vs)('<div class="text-xs text-success p-3">no errors'),eI=(0,n.vs)('<div class="bg-bg-surface border border-border-default">'),eZ=(0,n.vs)("<span class=text-text-default>"),eV=(0,n.vs)('<div class="text-text-tertiary font-mono pl-4 truncate">'),eD=(0,n.vs)('<div class="px-2 py-1 border-b border-border-subtle text-xs hover:bg-bg-surface-raised"><div class="flex items-center space-x-2"><span></span><span class=text-text-muted></span><span class="text-text-secondary font-mono">');async function eN(t){return(await i.bx.getErrors({device:t,limit:1e3})).errors}function ej(t){let[e,{refetch:r}]=(0,s.Zg)(()=>t.fsPath,eN);return(0,s.Rc)(()=>{let t=()=>r();window.addEventListener("fs-refresh",t),(0,s.Ki)(()=>window.removeEventListener("fs-refresh",t))}),(0,s.a0)(s.tY,{get fallback(){return eT()},get children(){return(0,s.a0)(s.wv,{get when(){return e()},keyed:!0,children:t=>{var e;return e=eI(),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return 0===t.length},get children(){return eA()}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return t.length>0},get children(){return(0,s.a0)(s.a,{each:t,children:t=>{var e,r,a,i,l;return l=(i=(a=(r=(e=eD()).firstChild).firstChild).nextSibling).nextSibling,(0,n.Yr)(a,()=>t.errorType),(0,n.Yr)(i,()=>new Date(1e3*Number(t.timestamp)).toLocaleString("sv-SE",{dateStyle:"short",timeStyle:"short"})),(0,n.Yr)(l,()=>t.device),(0,n.Yr)(r,(0,s.a0)(s.wv,{get when(){return t.message},get children(){var o=eZ();return(0,n.Yr)(o,()=>t.message),o}}),null),(0,n.Yr)(e,(0,s.a0)(s.wv,{get when(){return t.path},get children(){var d=eV();return(0,n.Yr)(d,()=>t.path),d}}),null),(0,s.gb)(()=>{var e;return(0,n.s7)(a,"corruption_err"===(e=t.errorType)?"text-error":"generation_err"===e?"text-warning-soft":e.includes("io_err")?"text-warning":"text-text-tertiary")}),e}})}}),null),e}})}})}var eO=(0,n.vs)("<div>"),eq=(0,n.vs)('<div class="border-t border-border-default pt-3 mt-3 text-xs text-text-tertiary space-y-1"><div><span>path: </span><span class="font-mono text-text-default"></span></div><div><span>id: </span><span class=text-text-default>');function eU(t){let[e,r]=(0,s.n5)(""),[a,l]=(0,s.n5)(""),[o,u]=(0,s.n5)(!1),[h,g]=(0,s.n5)(!1),[x,p]=(0,s.n5)("");(0,s.EH)(()=>{(0,s.vA)(()=>{r(t.fs.label),l(t.fs.btrbkSnapshotDir)})});let b=async()=>{(0,s.vA)(()=>{u(!0),p(""),g(!1)});try{await i.bx.updateFilesystem({id:t.fs.id,label:e(),btrbkSnapshotDir:a().replace(/^\//,"")}),g(!0),t.onSave(),setTimeout(()=>g(!1),3e3)}catch(t){p(String(t))}finally{u(!1)}};return(0,s.a0)(c.Zp,{class:"p-3 space-y-3",get children(){var v,f,m,w,y;return[(0,s.a0)(s.wv,{get when(){return x()},get children(){return(0,s.a0)(c.Fc,{type:"error",get children(){return x()}})}}),(0,s.a0)(s.wv,{get when(){return h()},get children(){return(0,s.a0)(c.Fc,{type:"success",children:"settings saved"})}}),(0,s.a0)(c.ox,{label:"name",get value(){return e()},onChange:r,get placeholder(){let e;return(e=t.fs.path.replace(/\/$/,"").split("/"))[e.length-1]||""},hint:"display name for this filesystem",class:"max-w-xs"}),(0,s.a0)(c.ox,{label:"btrbk snapshot directory",get value(){return a()},onChange:l,placeholder:".snapshots",mono:!0,hint:"subvolumes under this directory will be treated as btrbk snapshots",class:"max-w-xs"}),(v=eO(),(0,n.Yr)(v,(0,s.a0)(c.$n,{variant:"primary",get disabled(){return o()||e()===t.fs.label&&a()===t.fs.btrbkSnapshotDir},onClick:b,get children(){return o()?"saving...":"save"}})),v),(w=(m=(f=eq()).firstChild).firstChild.nextSibling,y=m.nextSibling.firstChild.nextSibling,(0,n.Yr)(w,()=>t.fs.path),(0,n.Yr)(y,()=>(0,d.ZV)(t.fs.id)),f)]}})}var eX=(0,n.vs)('<div><div class="flex items-end justify-between"><div class=flex></div></div><div class="border border-border-default bg-bg-surface p-3">'),eH=(0,n.vs)('<div class="text-xs text-text-tertiary">loading...');async function eK(t){let e=BigInt(t),r=(await i.bx.listTrackedFilesystems({})).filesystems.find(t=>t.id===e);return r&&(0,l.Mg)(r),r??null}function eG(){var t,e,r,i;let l=(0,a.g)(),[u,{refetch:h}]=(0,s.Zg)(()=>l.id,eK),[g,x]=(0,s.n5)(new Set),[p,b]=(0,s.n5)("");(0,s.Rc)(()=>{let t=()=>{h(),window.dispatchEvent(new CustomEvent("fs-refresh"))};window.addEventListener("refresh",t),(0,s.Ki)(()=>window.removeEventListener("refresh",t))});let v=(0,s.To)(()=>l.tab||"overview");return r=(e=(t=eX()).firstChild).firstChild,i=e.nextSibling,(0,n.Yr)(r,(0,s.a0)(s.a,{each:[{id:"overview",label:"overview"},{id:"usage",label:"usage"},{id:"subvolumes",label:"subvolumes"},{id:"maintenance",label:"maintenance"},{id:"visualize",label:"visualize"},{id:"errors",label:"errors"},{id:"config",label:"config"}],children:t=>(0,s.a0)(a.A,{get href(){return`/fs/${l.id}/${t.id}`},get class(){return(0,d.cn)("px-3 py-1 text-xs select-none border-t border-x -mb-px",v()===t.id?"border-border-default bg-bg-surface text-text-default":"border-transparent text-text-tertiary hover:text-text-default hover:bg-bg-surface-raised")},draggable:!1,get children(){return t.label}})})),(0,n.Yr)(e,(0,s.a0)(c.OY,{options:[{label:"human",value:!1},{label:"raw",value:!0}],get value(){return(0,o.mH)().showRawBytes},onChange:o.jK,class:"mb-1"}),null),(0,n.Yr)(i,(0,s.a0)(s.wv,{get when(){return p()},get children(){return(0,s.a0)(c.Fc,{type:"error",class:"mb-2",get children(){return p()}})}}),null),(0,n.Yr)(i,(0,s.a0)(s.tY,{get fallback(){return eH()},get children(){return(0,s.a0)(s.wv,{get when(){return u()},keyed:!0,children:t=>[(0,s.a0)(s.wv,{get when(){return"overview"===v()},get children(){return(0,s.a0)(te,{fs:t})}}),(0,s.a0)(s.wv,{get when(){return"usage"===v()},get children(){return(0,s.a0)(tP,{fs:t})}}),(0,s.a0)(s.wv,{get when(){return"subvolumes"===v()},get children(){return(0,s.a0)(tV,{fs:t,get expandedNodes(){return g()},setExpandedNodes:x})}}),(0,s.a0)(s.wv,{get when(){return"maintenance"===v()},get children(){return(0,s.a0)(er,{fs:t,setError:b,onRefresh:h})}}),(0,s.a0)(s.wv,{get when(){return"visualize"===v()},get children(){return(0,s.a0)(e_,{get fsPath(){return t.path}})}}),(0,s.a0)(s.wv,{get when(){return"errors"===v()},get children(){return(0,s.a0)(ej,{get fsPath(){return t.path}})}}),(0,s.a0)(s.wv,{get when(){return"config"===v()},get children(){return(0,s.a0)(eU,{fs:t,onSave:h})}})]})}}),null),t}}}]);
//# sourceMappingURL=filesystem.0933d477.js.map