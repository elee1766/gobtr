"use strict";(self.webpackChunkgobtr_web=self.webpackChunkgobtr_web||[]).push([["615"],{494:function(t,e,r){r.r(e),r.d(e,{default:()=>k});var s=r(35),l=r(701),n=r(953),a=r(359),i=r(369),o=r(37),u=r(548),d=(0,s.vs)('<div class="bg-bg-surface-raised border-b border-border-default p-2"><div class="flex flex-wrap gap-2 items-end">'),c=(0,s.vs)('<div class="text-xs text-text-tertiary p-4 text-center">no filesystems tracked. click + add to add one.'),b=(0,s.vs)('<table class="w-full text-xs"><thead class="bg-bg-muted border-b border-border-subtle"><tr><th class="px-2 py-1 text-left text-text-tertiary font-normal">path</th><th class="px-2 py-1 text-left text-text-tertiary font-normal">usage</th><th class="px-2 py-1 text-right text-text-tertiary font-normal">subvols</th><th class="px-2 py-1 text-right text-text-tertiary font-normal">errors</th><th class="px-2 py-1 text-left text-text-tertiary font-normal">scrub</th><th class="px-2 py-1 text-right text-text-tertiary font-normal"></th></tr></thead><tbody>'),h=(0,s.vs)('<div class="border border-border-default bg-bg-surface"><div class="flex items-center justify-end px-2 py-1 bg-bg-surface-raised border-b border-border-default"><button class="text-xs text-text-tertiary hover:text-text-default cursor-pointer">+ add'),x=(0,s.vs)("<div class=space-y-2>"),p=(0,s.vs)('<div class="text-xs text-text-tertiary p-2">loading...'),g=(0,s.vs)("<span>"),f=(0,s.vs)('<span class="text-text-muted font-mono ml-1">'),v=(0,s.vs)('<div class="flex items-center space-x-2"><span class="text-text-secondary font-mono"></span><span class=text-text-muted>/</span><span class="text-text-tertiary font-mono">'),y=(0,s.vs)("<span class=text-text-muted>+"),m=(0,s.vs)(`<tr class="border-b border-border-subtle hover:bg-bg-surface-raised"><td class="px-2 py-2"></td><td class="px-2 py-2"></td><td class="px-2 py-2 text-right text-text-secondary"></td><td class="px-2 py-2 text-right"><span></span></td><td class="px-2 py-2"></td><td class="px-2 py-2 text-right"><button class="text-error-soft hover:text-error-hover hover:bg-error-subtle px-1 cursor-pointer"title="Remove filesystem">\xd7`),w=(0,s.vs)("<span class=text-text-muted>-");async function C(){let[t,e,r,s,l]=await Promise.all([a.bx.listTrackedFilesystems({}),a.qy.listAllSubvolumes({}),a.bx.getAllErrors({limit:1e3}),a.ZV.getAllScrubStatus({}),a.bx.getAllDeviceStats({})]),n=[];for(let a of t.filesystems){(0,i.Mg)(a);let t={id:a.id,path:a.path,label:a.label,subvolumeCount:0,backupCount:0,errorCount:0,scrubStatus:"",scrubRunning:!1,btrbkConfigured:""!==a.btrbkSnapshotDir,totalBytes:0n,usedBytes:0n,freeBytes:0n},d=e.filesystems.find(t=>t.path===a.path);if(d){let e=a.btrbkSnapshotDir?(0,o.BH)(d.subvolumes,a.btrbkSnapshotDir):0;t.backupCount=e,t.subvolumeCount=d.subvolumes.length-e}let c=r.filesystems.find(t=>t.path===a.path);c&&(t.errorCount=c.errors.length);let b=s.filesystems.find(t=>t.path===a.path);if(b){var u;t.scrubRunning=b.isRunning,t.scrubStatus=(null==(u=b.progress)?void 0:u.status)||""}let h=l.filesystems.find(t=>t.path===a.path);if(h&&h.devices)for(let e of h.devices)t.totalBytes+=e.totalBytes,t.usedBytes+=e.usedBytes,t.freeBytes+=e.freeBytes;n.push(t)}return n}function k(){var t;let[e,{refetch:r}]=(0,l.Zg)(C),[i,k]=(0,l.n5)(!1),[Y,S]=(0,l.n5)(""),[B,A]=(0,l.n5)(""),[$,R]=(0,l.n5)(""),[z,D]=(0,l.n5)(!1),[Z,F]=(0,l.n5)("");(0,l.Rc)(()=>{let t=()=>r();window.addEventListener("refresh",t),(0,l.Ki)(()=>window.removeEventListener("refresh",t))});let V=async()=>{if(Y()){D(!0),F("");try{await a.bx.addFilesystem({path:Y(),label:B(),btrbkSnapshotDir:$()}),(0,l.vA)(()=>{S(""),A(""),R(""),k(!1)}),r()}catch(t){F(String(t))}finally{D(!1)}}},E=async t=>{try{await a.bx.removeFilesystem({id:t}),r()}catch(t){F(String(t))}};return t=x(),(0,s.Yr)(t,(0,l.a0)(l.wv,{get when(){return Z()},get children(){return(0,l.a0)(u.Fc,{type:"error",get children(){return Z()}})}}),null),(0,s.Yr)(t,(0,l.a0)(l.tY,{get fallback(){return p()},get children(){var _=h();return _.firstChild.firstChild.$$click=()=>k(!i()),(0,s.Yr)(_,(0,l.a0)(l.wv,{get when(){return i()},get children(){var L=d(),j=L.firstChild;return(0,s.Yr)(j,(0,l.a0)(u.ox,{label:"path",get value(){return Y()},onChange:S,placeholder:"/mnt/btrfs",mono:!0,class:"flex-1 min-w-[150px]"}),null),(0,s.Yr)(j,(0,l.a0)(u.ox,{label:"label",get value(){return B()},onChange:A,placeholder:"optional",class:"w-24"}),null),(0,s.Yr)(j,(0,l.a0)(u.ox,{label:"btrbk snapshot dir",get value(){return $()},onChange:R,placeholder:".snapshots",mono:!0,class:"flex-1 min-w-[150px]"}),null),(0,s.Yr)(j,(0,l.a0)(u.$n,{variant:"primary",get disabled(){return z()||!Y()},onClick:V,children:"add"}),null),(0,s.Yr)(j,(0,l.a0)(u.$n,{variant:"ghost",onClick:()=>{(0,l.vA)(()=>{k(!1),S(""),A(""),R("")})},children:"cancel"}),null),L}}),null),(0,s.Yr)(_,(0,l.a0)(l.wv,{get when(){var q;return(null==(q=e())?void 0:q.length)===0},get children(){return c()}}),null),(0,s.Yr)(_,(0,l.a0)(l.wv,{get when(){var H;return((null==(H=e())?void 0:H.length)??0)>0},get children(){var K=b(),M=K.firstChild.nextSibling;return(0,s.Yr)(M,(0,l.a0)(l.a,{get each(){return e()},children:t=>{var e,r,a,i,d,c,b,h;return c=(d=(i=(a=(r=(e=m()).firstChild).nextSibling).nextSibling).nextSibling).firstChild,h=(b=d.nextSibling).nextSibling.firstChild,(0,s.Yr)(r,(0,l.a0)(n.A,{get href(){return`/fs/${t.id}`},class:"text-primary hover:text-primary-strong hover:underline",get children(){var x;return[(x=g(),(0,s.Yr)(x,()=>t.label||t.path),x),(0,l.a0)(l.wv,{get when(){return t.label},get children(){var p=f();return(0,s.Yr)(p,()=>t.path),p}})]}})),(0,s.Yr)(a,(0,l.a0)(l.wv,{get when(){return t.totalBytes>0n},get fallback(){return w()},get children(){var C=v(),k=C.firstChild,Y=k.nextSibling.nextSibling;return(0,s.Yr)(C,(0,l.a0)(u.z2,{get value(){return t.totalBytes>0n?Number(100n*t.usedBytes/t.totalBytes):0},thresholdColors:!0,size:"md",class:"w-16"}),k),(0,s.Yr)(k,()=>(0,o.z3)(t.usedBytes)),(0,s.Yr)(Y,()=>(0,o.z3)(t.totalBytes)),C}})),(0,s.Yr)(i,()=>(0,o.ZV)(t.subvolumeCount),null),(0,s.Yr)(i,(0,l.a0)(l.wv,{get when(){return t.backupCount>0},get children(){var S=y();return S.firstChild,(0,s.Yr)(S,()=>(0,o.ZV)(t.backupCount),null),S}}),null),(0,s.Yr)(c,()=>(0,o.ZV)(t.errorCount)),(0,s.Yr)(b,(0,l.a0)(u.so,{get running(){return t.scrubRunning},get status(){return t.scrubStatus}})),h.$$click=()=>E(t.id),(0,l.gb)(()=>(0,s.s7)(c,(0,o.cn)(t.errorCount>0?"text-error":"text-text-muted"))),e}})),K}}),null),_}}),null),t}(0,s.z_)(["click"])}}]);
//# sourceMappingURL=home.8b9215c5.js.map